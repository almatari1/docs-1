<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2262px" preserveAspectRatio="none" style="width:1920px;height:2262px;" version="1.1" viewBox="0 0 1920 2262" width="1920px" zoomAndPan="magnify"><defs><filter height="300%" id="fe0uqjltbs8c" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="419" x="751.5" y="22.9951">1.1.1.b. Prepare Handler Consume (batch messages)</text><rect fill="#FFFFE0" height="2217.1563" style="stroke: #A80036; stroke-width: 1.0;" width="1833" x="19" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="880" y="46.3638">Central Service</text><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="77.5" y="170.9922"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="2050.4297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="461.5" y="125.7266"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="993.5" y="2124.1563"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1399.5" y="955.0469"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="121.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1399.5" y="1579.4375"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1515" y="424.9219"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1515" y="689.9844"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1795" y="454.0547"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1795" y="719.1172"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1795" y="984.1797"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1795" y="1608.5703"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="2036.4297" style="stroke: #000000; stroke-width: 2.0;" width="1896" x="13" y="132.7266"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="156.6641" style="stroke: #000000; stroke-width: 2.0;" width="828" x="376.5" y="215.9922"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="251.0625" style="stroke: #000000; stroke-width: 2.0;" width="1481.5" x="376.5" y="386.6563"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="251.0625" style="stroke: #000000; stroke-width: 2.0;" width="1481.5" x="376.5" y="651.7188"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="208.9297" style="stroke: #000000; stroke-width: 2.0;" width="1481.5" x="376.5" y="916.7813"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="1022.4453" style="stroke: #000000; stroke-width: 2.0;" width="1542.5" x="356.5" y="1139.7109"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="363.3281" style="stroke: #000000; stroke-width: 2.0;" width="642" x="366.5" y="1163.8438"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="619" x="376.5" y="1187.9766"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="622" x="376.5" y="1261.2422"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="562" x="376.5" y="1334.5078"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="167.6641" style="stroke: #000000; stroke-width: 2.0;" width="1512.5" x="376.5" y="1541.1719"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="82" x2="82" y1="115.7266" y2="2186.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="466.5" x2="466.5" y1="115.7266" y2="2186.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="998.5" x2="998.5" y1="115.7266" y2="2186.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1142.5" x2="1142.5" y1="115.7266" y2="2186.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1274.5" x2="1274.5" y1="115.7266" y2="2186.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1404.5" x2="1404.5" y1="115.7266" y2="2186.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1519.5" x2="1519.5" y1="115.7266" y2="2186.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1800" x2="1800" y1="115.7266" y2="2186.1563"/><rect fill="#FEFECE" filter="url(#fe0uqjltbs8c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="27" y="76.4297"/><rect fill="#FEFECE" filter="url(#fe0uqjltbs8c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="23" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="30" y="100.4248">Prepare-Topic</text><rect fill="#FEFECE" filter="url(#fe0uqjltbs8c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="27" y="2185.1563"/><rect fill="#FEFECE" filter="url(#fe0uqjltbs8c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="23" y="2189.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="30" y="2209.1514">Prepare-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="386.5" y="112.4248">Prepare Event Handler</text><ellipse cx="466.5" cy="83.4297" fill="#FEFECE" filter="url(#fe0uqjltbs8c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="462.5,71.4297,468.5,66.4297,466.5,71.4297,468.5,76.4297,462.5,71.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="386.5" y="2198.1514">Prepare Event Handler</text><ellipse cx="466.5" cy="2217.4531" fill="#FEFECE" filter="url(#fe0uqjltbs8c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="462.5,2205.4531,468.5,2200.4531,466.5,2205.4531,468.5,2210.4531,462.5,2205.4531" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fe0uqjltbs8c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="920.5" y="76.4297"/><rect fill="#FEFECE" filter="url(#fe0uqjltbs8c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="916.5" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="923.5" y="100.4248">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#fe0uqjltbs8c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="920.5" y="2185.1563"/><rect fill="#FEFECE" filter="url(#fe0uqjltbs8c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="916.5" y="2189.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="923.5" y="2209.1514">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#fe0uqjltbs8c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1094.5" y="76.4297"/><rect fill="#FEFECE" filter="url(#fe0uqjltbs8c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1090.5" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1097.5" y="100.4248">Event-Topic</text><rect fill="#FEFECE" filter="url(#fe0uqjltbs8c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1094.5" y="2185.1563"/><rect fill="#FEFECE" filter="url(#fe0uqjltbs8c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1090.5" y="2189.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1097.5" y="2209.1514">Event-Topic</text><rect fill="#FEFECE" filter="url(#fe0uqjltbs8c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="1208.5" y="76.4297"/><rect fill="#FEFECE" filter="url(#fe0uqjltbs8c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="1204.5" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="1211.5" y="100.4248">Notification-Topic</text><rect fill="#FEFECE" filter="url(#fe0uqjltbs8c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="1208.5" y="2185.1563"/><rect fill="#FEFECE" filter="url(#fe0uqjltbs8c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="1204.5" y="2189.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="1211.5" y="2209.1514">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="1355.5" y="112.4248">Transfer DAO</text><ellipse cx="1404.5" cy="83.4297" fill="#FEFECE" filter="url(#fe0uqjltbs8c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1392.5" x2="1416.5" y1="97.4297" y2="97.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="1355.5" y="2198.1514">Transfer DAO</text><ellipse cx="1404.5" cy="2217.4531" fill="#FEFECE" filter="url(#fe0uqjltbs8c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1392.5" x2="1416.5" y1="2231.4531" y2="2231.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="1463.5" y="112.4248">Participant DAO</text><ellipse cx="1520" cy="83.4297" fill="#FEFECE" filter="url(#fe0uqjltbs8c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1508" x2="1532" y1="97.4297" y2="97.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="1463.5" y="2198.1514">Participant DAO</text><ellipse cx="1520" cy="2217.4531" fill="#FEFECE" filter="url(#fe0uqjltbs8c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1508" x2="1532" y1="2231.4531" y2="2231.4531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1752" y="112.4248">Central Store</text><path d="M1782,63.4297 C1782,53.4297 1800,53.4297 1800,53.4297 C1800,53.4297 1818,53.4297 1818,63.4297 L1818,89.4297 C1818,99.4297 1800,99.4297 1800,99.4297 C1800,99.4297 1782,99.4297 1782,89.4297 L1782,63.4297 " fill="#FEFECE" filter="url(#fe0uqjltbs8c)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1782,63.4297 C1782,73.4297 1800,73.4297 1800,73.4297 C1800,73.4297 1818,73.4297 1818,63.4297 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1752" y="2198.1514">Central Store</text><path d="M1782,2211.4531 C1782,2201.4531 1800,2201.4531 1800,2201.4531 C1800,2201.4531 1818,2201.4531 1818,2211.4531 L1818,2237.4531 C1818,2247.4531 1800,2247.4531 1800,2247.4531 C1800,2247.4531 1782,2247.4531 1782,2237.4531 L1782,2211.4531 " fill="#FEFECE" filter="url(#fe0uqjltbs8c)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1782,2211.4531 C1782,2221.4531 1800,2221.4531 1800,2221.4531 C1800,2221.4531 1818,2221.4531 1818,2211.4531 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="77.5" y="170.9922"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="2050.4297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="461.5" y="125.7266"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="993.5" y="2124.1563"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1399.5" y="955.0469"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="121.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1399.5" y="1579.4375"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1515" y="424.9219"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1515" y="689.9844"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1795" y="454.0547"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1795" y="719.1172"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1795" y="984.1797"/><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1795" y="1608.5703"/><path d="M13,132.7266 L253,132.7266 L253,139.7266 L243,149.7266 L13,149.7266 L13,132.7266 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2036.4297" style="stroke: #000000; stroke-width: 2.0;" width="1896" x="13" y="132.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="195" x="28" y="145.7935">Prepare Handler Consume</text><polygon fill="#A80036" points="98.5,166.9922,88.5,170.9922,98.5,174.9922,94.5,170.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="92.5" x2="460.5" y1="170.9922" y2="170.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="104.5" y="165.9263">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="342" x="117.5" y="165.9263">Consume Prepare event batch of messages for Payer</text><path d="M376.5,215.9922 L608.5,215.9922 L608.5,222.9922 L598.5,232.9922 L376.5,232.9922 L376.5,215.9922 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="156.6641" style="stroke: #000000; stroke-width: 2.0;" width="828" x="376.5" y="215.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="391.5" y="229.0591">Persist Event Information</text><polygon fill="#A80036" points="1130.5,275.2578,1140.5,279.2578,1130.5,283.2578,1134.5,279.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="1136.5" y1="279.2578" y2="279.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="478.5" y="274.1919">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="491.5" y="274.1919">Publish event information</text><rect fill="#FFFFFF" filter="url(#fe0uqjltbs8c)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="810" x="383.5" y="287.2578"/><polygon fill="#EEEEEE" points="383.5,287.2578,449.5,287.2578,449.5,294.2578,439.5,304.2578,383.5,304.2578,383.5,287.2578" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="396.5" y="301.3247">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="683" y="320.3247">Event Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="36" x="850" y="320.3247">9.1.0.</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="850" x2="886" y1="322.3247" y2="322.3247"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="886" y="320.3247">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="687" y="335.4575"/><path d="M376.5,386.6563 L646.5,386.6563 L646.5,393.6563 L636.5,403.6563 L376.5,403.6563 L376.5,386.6563 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="251.0625" style="stroke: #000000; stroke-width: 2.0;" width="1481.5" x="376.5" y="386.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="225" x="391.5" y="399.7231">Fetch batch Payer information</text><polygon fill="#A80036" points="1503,420.9219,1513,424.9219,1503,428.9219,1507,424.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="1509" y1="424.9219" y2="424.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="478.5" y="419.856">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="410" x="491.5" y="419.856">Request to retrieve batch of Payer Participant details (if it exists)</text><polygon fill="#A80036" points="1783,450.0547,1793,454.0547,1783,458.0547,1787,454.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1525" x2="1789" y1="454.0547" y2="454.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1532" y="448.9888">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="1545" y="448.9888">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#fe0uqjltbs8c)" points="1764,467.0547,1836,467.0547,1846,478.0547,1836,490.0547,1764,490.0547,1754,478.0547,1764,467.0547" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1766" y="483.1216">participant</text><polygon fill="#A80036" points="1536,512.3203,1526,516.3203,1536,520.3203,1532,516.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1530" x2="1799" y1="516.3203" y2="516.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1542" y="511.2544">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="1555" y="511.2544">Return Participant details if it exists</text><polygon fill="#A80036" points="482.5,541.4531,472.5,545.4531,482.5,549.4531,478.5,545.4531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="476.5" x2="1519" y1="545.4531" y2="545.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="488.5" y="540.3872">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="501.5" y="540.3872">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="513.5" y1="574.5859" y2="574.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="513.5" x2="513.5" y1="574.5859" y2="587.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="472.5" x2="513.5" y1="587.5859" y2="587.5859"/><polygon fill="#A80036" points="482.5,583.5859,472.5,587.5859,482.5,591.5859,478.5,587.5859" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="478.5" y="569.52">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="491.5" y="569.52">Validate Payer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="513.5" y1="616.7188" y2="616.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="513.5" x2="513.5" y1="616.7188" y2="629.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="472.5" x2="513.5" y1="629.7188" y2="629.7188"/><polygon fill="#A80036" points="482.5,625.7188,472.5,629.7188,482.5,633.7188,478.5,629.7188" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="478.5" y="611.6528">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="382" x="491.5" y="611.6528">store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYER</text><path d="M376.5,651.7188 L649.5,651.7188 L649.5,658.7188 L639.5,668.7188 L376.5,668.7188 L376.5,651.7188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="251.0625" style="stroke: #000000; stroke-width: 2.0;" width="1481.5" x="376.5" y="651.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="228" x="391.5" y="664.7856">Fetch batch Payee information</text><polygon fill="#A80036" points="1503,685.9844,1513,689.9844,1503,693.9844,1507,689.9844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="1509" y1="689.9844" y2="689.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="478.5" y="684.9185">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="413" x="491.5" y="684.9185">Request to retrieve batch of Payee Participant details (if it exists)</text><polygon fill="#A80036" points="1783,715.1172,1793,719.1172,1783,723.1172,1787,719.1172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1525" x2="1789" y1="719.1172" y2="719.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1532" y="714.0513">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="1554" y="714.0513">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#fe0uqjltbs8c)" points="1764,732.1172,1836,732.1172,1846,743.1172,1836,755.1172,1764,755.1172,1754,743.1172,1764,732.1172" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1766" y="748.1841">participant</text><polygon fill="#A80036" points="1536,777.3828,1526,781.3828,1536,785.3828,1532,781.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1530" x2="1799" y1="781.3828" y2="781.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1542" y="776.3169">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="1564" y="776.3169">Return Participant details if it exists</text><polygon fill="#A80036" points="482.5,806.5156,472.5,810.5156,482.5,814.5156,478.5,810.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="476.5" x2="1519" y1="810.5156" y2="810.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="488.5" y="805.4497">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="510.5" y="805.4497">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="513.5" y1="839.6484" y2="839.6484"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="513.5" x2="513.5" y1="839.6484" y2="852.6484"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="472.5" x2="513.5" y1="852.6484" y2="852.6484"/><polygon fill="#A80036" points="482.5,848.6484,472.5,852.6484,482.5,856.6484,478.5,852.6484" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="478.5" y="834.5825">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="500.5" y="834.5825">Validate Payee</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="513.5" y1="881.7813" y2="881.7813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="513.5" x2="513.5" y1="881.7813" y2="894.7813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="472.5" x2="513.5" y1="894.7813" y2="894.7813"/><polygon fill="#A80036" points="482.5,890.7813,472.5,894.7813,482.5,898.7813,478.5,894.7813" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="478.5" y="876.7153">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="382" x="500.5" y="876.7153">store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYEE</text><path d="M376.5,916.7813 L601.5,916.7813 L601.5,923.7813 L591.5,933.7813 L376.5,933.7813 L376.5,916.7813 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="208.9297" style="stroke: #000000; stroke-width: 2.0;" width="1481.5" x="376.5" y="916.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="391.5" y="929.8481">Fetch batch of transfers</text><polygon fill="#A80036" points="1387.5,951.0469,1397.5,955.0469,1387.5,959.0469,1391.5,955.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="1393.5" y1="955.0469" y2="955.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="478.5" y="949.981">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="500.5" y="949.981">Request to retrieve batch of Transfers (if it exists)</text><polygon fill="#A80036" points="1783,980.1797,1793,984.1797,1783,988.1797,1787,984.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1409.5" x2="1789" y1="984.1797" y2="984.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1416.5" y="979.1138">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="1438.5" y="979.1138">Request batch of Transfers</text><polygon fill="#FFFFE0" filter="url(#fe0uqjltbs8c)" points="1773,997.1797,1827,997.1797,1837,1008.1797,1827,1020.1797,1773,1020.1797,1763,1008.1797,1773,997.1797" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="1775" y="1013.2466">transfer</text><polygon fill="#A80036" points="1420.5,1042.4453,1410.5,1046.4453,1420.5,1050.4453,1416.5,1046.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1414.5" x2="1799" y1="1046.4453" y2="1046.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1426.5" y="1041.3794">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="1448.5" y="1041.3794">Return batch of Transfers (if it exists)</text><polygon fill="#A80036" points="482.5,1071.5781,472.5,1075.5781,482.5,1079.5781,478.5,1075.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="476.5" x2="1403.5" y1="1075.5781" y2="1075.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="488.5" y="1070.5122">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="510.5" y="1070.5122">Return batch of Transfer (if it exists)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="513.5" y1="1104.7109" y2="1104.7109"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="513.5" x2="513.5" y1="1104.7109" y2="1117.7109"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="472.5" x2="513.5" y1="1117.7109" y2="1117.7109"/><polygon fill="#A80036" points="482.5,1113.7109,472.5,1117.7109,482.5,1121.7109,478.5,1117.7109" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="478.5" y="1099.645">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="260" x="500.5" y="1099.645">store result set in var: $LIST_TRANSFERS</text><path d="M356.5,1139.7109 L433.5,1139.7109 L433.5,1146.7109 L423.5,1156.7109 L356.5,1156.7109 L356.5,1139.7109 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1022.4453" style="stroke: #000000; stroke-width: 2.0;" width="1542.5" x="356.5" y="1139.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="371.5" y="1152.7778">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="448.5" y="1151.9214">[for each message in batch]</text><path d="M366.5,1163.8438 L602.5,1163.8438 L602.5,1170.8438 L592.5,1180.8438 L366.5,1180.8438 L366.5,1163.8438 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="363.3281" style="stroke: #000000; stroke-width: 2.0;" width="642" x="366.5" y="1163.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="191" x="381.5" y="1176.9106">Validate Prepare Transfer</text><path d="M376.5,1187.9766 L529.5,1187.9766 L529.5,1194.9766 L519.5,1204.9766 L376.5,1204.9766 L376.5,1187.9766 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="619" x="376.5" y="1187.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="391.5" y="1201.0435">Validate Payer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="513.5" y1="1226.2422" y2="1226.2422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="513.5" x2="513.5" y1="1226.2422" y2="1239.2422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="472.5" x2="513.5" y1="1239.2422" y2="1239.2422"/><polygon fill="#A80036" points="482.5,1235.2422,472.5,1239.2422,482.5,1243.2422,478.5,1239.2422" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="478.5" y="1221.1763">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="483" x="500.5" y="1221.1763">Validate Payer against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYER</text><path d="M376.5,1261.2422 L532.5,1261.2422 L532.5,1268.2422 L522.5,1278.2422 L376.5,1278.2422 L376.5,1261.2422 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="622" x="376.5" y="1261.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="391.5" y="1274.3091">Validate Payee</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="513.5" y1="1299.5078" y2="1299.5078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="513.5" x2="513.5" y1="1299.5078" y2="1312.5078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="472.5" x2="513.5" y1="1312.5078" y2="1312.5078"/><polygon fill="#A80036" points="482.5,1308.5078,472.5,1312.5078,482.5,1316.5078,478.5,1312.5078" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="478.5" y="1294.4419">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="486" x="500.5" y="1294.4419">Validate Payee against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYEE</text><path d="M376.5,1334.5078 L539.5,1334.5078 L539.5,1341.5078 L529.5,1351.5078 L376.5,1351.5078 L376.5,1334.5078 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="562" x="376.5" y="1334.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="391.5" y="1347.5747">Duplicate check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="513.5" y1="1372.7734" y2="1372.7734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="513.5" x2="513.5" y1="1372.7734" y2="1385.7734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="472.5" x2="513.5" y1="1385.7734" y2="1385.7734"/><polygon fill="#A80036" points="482.5,1381.7734,472.5,1385.7734,482.5,1389.7734,478.5,1385.7734" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="478.5" y="1367.7075">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="426" x="500.5" y="1367.7075">Validate duplicate Check against in-memory var $LIST_TRANSFERS</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="513.5" y1="1421.9063" y2="1421.9063"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="513.5" x2="513.5" y1="1421.9063" y2="1434.9063"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="472.5" x2="513.5" y1="1434.9063" y2="1434.9063"/><polygon fill="#A80036" points="482.5,1430.9063,472.5,1434.9063,482.5,1438.9063,478.5,1434.9063" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="478.5" y="1416.8403">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="500.5" y="1416.8403">Validate amount</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="513.5" y1="1464.0391" y2="1464.0391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="513.5" x2="513.5" y1="1464.0391" y2="1477.0391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="472.5" x2="513.5" y1="1477.0391" y2="1477.0391"/><polygon fill="#A80036" points="482.5,1473.0391,472.5,1477.0391,482.5,1481.0391,478.5,1477.0391" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="478.5" y="1458.9731">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="500.5" y="1458.9731">Validate crypto-condition</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="513.5" y1="1506.1719" y2="1506.1719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="513.5" x2="513.5" y1="1506.1719" y2="1519.1719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="472.5" x2="513.5" y1="1519.1719" y2="1519.1719"/><polygon fill="#A80036" points="482.5,1515.1719,472.5,1519.1719,482.5,1523.1719,478.5,1519.1719" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="478.5" y="1501.106">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="434" x="500.5" y="1501.106">Validate message signature (to be confirmed in future requirement)</text><path d="M376.5,1541.1719 L964.5,1541.1719 L964.5,1548.1719 L954.5,1558.1719 L376.5,1558.1719 L376.5,1541.1719 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="167.6641" style="stroke: #000000; stroke-width: 2.0;" width="1512.5" x="376.5" y="1541.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="543" x="391.5" y="1554.2388">Persist Transfer State (with transferState='RECEIVED' on validation pass)</text><polygon fill="#A80036" points="1387.5,1575.4375,1397.5,1579.4375,1387.5,1583.4375,1391.5,1579.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="1393.5" y1="1579.4375" y2="1579.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="478.5" y="1574.3716">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="500.5" y="1574.3716">Request to persist transfer</text><polygon fill="#A80036" points="1783,1604.5703,1793,1608.5703,1783,1612.5703,1787,1608.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1409.5" x2="1789" y1="1608.5703" y2="1608.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1416.5" y="1603.5044">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="1438.5" y="1603.5044">Persist transfer</text><polygon fill="#FFFFE0" filter="url(#fe0uqjltbs8c)" points="1731,1651.5703,1869,1651.5703,1879,1662.5703,1869,1674.5703,1731,1674.5703,1721,1662.5703,1731,1651.5703" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="1733" y="1667.6372">transferStateChange</text><polygon fill="#A80036" points="482.5,1696.8359,472.5,1700.8359,482.5,1704.8359,478.5,1700.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="476.5" x2="1403.5" y1="1700.8359" y2="1700.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="488.5" y="1695.77">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="510.5" y="1695.77">Return success</text><path d="M476,1720.8359 L476,2093.8359 L746,2093.8359 L746,1730.8359 L736,1720.8359 L476,1720.8359 " fill="#FFFF00" filter="url(#fe0uqjltbs8c)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M736,1720.8359 L736,1730.8359 L746,1730.8359 L736,1720.8359 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="482" y="1737.9028">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="482" y="1753.0356">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="498" y="1768.1685">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="498" y="1783.3013">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="498" y="1798.4341">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="498" y="1813.5669">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="498" y="1828.6997">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="514" y="1843.8325">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="514" y="1858.9653">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="498" y="1874.0981">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="498" y="1889.231">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="514" y="1904.3638">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="530" y="1919.4966">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="530" y="1934.6294">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="530" y="1949.7622">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="530" y="1964.895">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="530" y="1980.0278">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="530" y="1995.1606">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="546" y="2010.2935">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="546" y="2025.4263">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="530" y="2040.5591">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="514" y="2055.6919">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="498" y="2070.8247">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="482" y="2085.9575">}</text><polygon fill="#A80036" points="981.5,2120.1563,991.5,2124.1563,981.5,2128.1563,985.5,2124.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="987.5" y1="2124.1563" y2="2124.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="478.5" y="2119.0903">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="500.5" y="2119.0903">Route &amp; Publish Position event for Payer</text><!--
@startuml
title 1.1.1.b. Prepare Handler Consume (batch messages)

autonumber


collections "Prepare-Topic" as TOPIC_PREPARE
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-dfsp1" as TOPIC_POSITION_DFSP1
collections "Event-Topic" as TOPIC_EVENTS
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Transfer DAO" as TRANS_DAO
entity "Participant DAO" as PARTICIPANT_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_PREPARE
    participant PREP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant TOPIC_EVENTS
    participant TOPIC_NOTIFICATIONS
    participant TRANS_DAO
    participant PARTICIPANT_DAO
    participant DB
end box

activate PREP_HANDLER
group Prepare Handler Consume
    TOPIC_PREPARE <- PREP_HANDLER: Consume Prepare event batch of messages for Payer
    activate TOPIC_PREPARE
    deactivate TOPIC_PREPARE
    group Persist Event Information
        |||
        PREP_HANDLER -> TOPIC_EVENTS: Publish event information
        ref over PREP_HANDLER, TOPIC_EVENTS :  Event Handler Consume {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-event-9.1.0.svg 9.1.0.]]} \n
        |||
    end

    group Fetch batch Payer information
        PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve batch of Payer Participant details (if it exists)
        activate PARTICIPANT_DAO
        PARTICIPANT_DAO -> DB: Request Participant details
        hnote over DB #lightyellow
            participant
        end note
        activate DB
        PARTICIPANT_DAO <- - DB: Return Participant details if it exists
        deactivate DB
        PARTICIPANT_DAO - -> PREP_HANDLER: Return Participant details if it exists
        deactivate PARTICIPANT_DAO
        PREP_HANDLER <-> PREP_HANDLER: Validate Payer
        PREP_HANDLER -> PREP_HANDLER: store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYER
    end

    group Fetch batch Payee information
        PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve batch of Payee Participant details (if it exists)
        activate PARTICIPANT_DAO
        PARTICIPANT_DAO -> DB: Request Participant details
        hnote over DB #lightyellow
            participant
        end note
        activate DB
        PARTICIPANT_DAO <- - DB: Return Participant details if it exists
        deactivate DB
        PARTICIPANT_DAO - -> PREP_HANDLER: Return Participant details if it exists
        deactivate PARTICIPANT_DAO
        PREP_HANDLER <-> PREP_HANDLER: Validate Payee
        PREP_HANDLER -> PREP_HANDLER: store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYEE
    end

    group Fetch batch of transfers
        PREP_HANDLER -> TRANS_DAO: Request to retrieve batch of Transfers (if it exists)
        activate TRANS_DAO
        TRANS_DAO -> DB: Request batch of Transfers
        hnote over DB #lightyellow
            transfer
        end note
        activate DB
        TRANS_DAO <- - DB: Return batch of Transfers (if it exists)
        deactivate DB
        TRANS_DAO - -> PREP_HANDLER: Return batch of Transfer (if it exists)
        deactivate TRANS_DAO
        PREP_HANDLER -> PREP_HANDLER: store result set in var: $LIST_TRANSFERS
    end

    loop for each message in batch

        group Validate Prepare Transfer
            group Validate Payer
                PREP_HANDLER <-> PREP_HANDLER: Validate Payer against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYER
            end
            group Validate Payee
                PREP_HANDLER <-> PREP_HANDLER: Validate Payee against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYEE
            end
            group Duplicate check
                PREP_HANDLER <-> PREP_HANDLER: Validate duplicate Check against in-memory var $LIST_TRANSFERS
            end
            PREP_HANDLER <-> PREP_HANDLER: Validate amount
            PREP_HANDLER <-> PREP_HANDLER: Validate crypto-condition
            PREP_HANDLER <-> PREP_HANDLER: Validate message signature (to be confirmed in future requirement)
        end

        group Persist Transfer State (with transferState='RECEIVED' on validation pass)
            PREP_HANDLER -> TRANS_DAO: Request to persist transfer
            activate TRANS_DAO
            TRANS_DAO -> DB: Persist transfer
            hnote over DB #lightyellow
                transferStateChange
            end note
            activate DB
            deactivate DB
            TRANS_DAO - -> PREP_HANDLER: Return success
            deactivate TRANS_DAO
        end

        note right of PREP_HANDLER #yellow
            Message:
            {
                id: <transferMessage.transferId>
                from: <transferMessage.payerFsp>,
                to: <transferMessage.payeeFsp>,
                type: application/json
                content: {
                    headers: <transferHeaders>,
                    payload: <transferMessage>
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: position,
                        action: prepare,
                        createdAt: <timestamp>,
                        state: {
                            status: "success",
                            code: 0
                        }
                    }
                }
            }
        end note
        PREP_HANDLER -> TOPIC_POSITION_DFSP1: Route & Publish Position event for Payer
        activate TOPIC_POSITION_DFSP1
        deactivate TOPIC_POSITION_DFSP1
    end
end
deactivate PREP_HANDLER
@enduml

PlantUML version 1.2018.12(Sun Oct 21 05:15:15 CDT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_191-8u191-b12-0ubuntu0.16.04.1-b12
Operating System: Linux
OS Version: 4.4.0-31-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>