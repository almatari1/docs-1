<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3049px" preserveAspectRatio="none" style="width:2047px;height:3049px;" version="1.1" viewBox="0 0 2047 3049" width="2047px" zoomAndPan="magnify"><defs><filter height="300%" id="f1rhjkxxcjlb7b" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="298" x="875.5" y="22.9951">2.1.1. Fulfil Handler Consume (Reject)</text><rect fill="#FFFFE0" height="3004.1641" style="stroke: #A80036; stroke-width: 1.0;" width="1873.5" x="29" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="910.25" y="46.3638">Central Service</text><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="75.5" y="195.125"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="2837.4375" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="396.5" y="125.7266"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1018.5" y="2738.1563"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1300" y="2836.2266"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="150.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1429.5" y="677.25"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="135.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1429.5" y="938.5781"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="121.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1429.5" y="1507.3828"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1429.5" y="1711.1797"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="136.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1429.5" y="1957.375"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="770.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1429.5" y="2193.4375"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="92.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1845.5" y="706.3828"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="77.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1845.5" y="967.7109"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1845.5" y="1536.5156"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1845.5" y="1740.3125"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1845.5" y="1986.5078"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1845.5" y="2222.5703"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="2823.4375" style="stroke: #000000; stroke-width: 2.0;" width="2023" x="13" y="132.7266"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="2792.3047" style="stroke: #000000; stroke-width: 2.0;" width="2003" x="23" y="156.8594"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="105.5313" style="stroke: #000000; stroke-width: 2.0;" width="505" x="313.5" y="240.125"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="74.3984" style="stroke: #000000; stroke-width: 2.0;" width="485" x="323.5" y="264.2578"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="91.5313" style="stroke: #000000; stroke-width: 2.0;" width="911" x="323.5" y="359.6563"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="102.5313" style="stroke: #000000; stroke-width: 2.0;" width="1062" x="323.5" y="465.1875"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="1062.0625" style="stroke: #000000; stroke-width: 2.0;" width="1722.5" x="293.5" y="581.7188"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="751.6016" style="stroke: #000000; stroke-width: 2.0;" width="1674.5" x="303.5" y="885.1797"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="360.0703" style="stroke: #000000; stroke-width: 2.0;" width="1082" x="313.5" y="1089.2422"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="270" x="323.5" y="1113.375"/><rect fill="#FFFFFF" height="106.3359" style="stroke: none; stroke-width: 1.0;" width="1082" x="313.5" y="1179.6406"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="77.5313" style="stroke: #000000; stroke-width: 2.0;" width="1062" x="323.5" y="1201.4453"/><rect fill="#FFFFFF" height="88.0703" style="stroke: none; stroke-width: 1.0;" width="1082" x="313.5" y="1285.9766"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="242" x="323.5" y="1307.7813"/><rect fill="#FFFFFF" height="75.2656" style="stroke: none; stroke-width: 1.0;" width="1082" x="313.5" y="1374.0469"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="348" x="323.5" y="1383.0469"/><rect fill="#FFFFFF" height="180.4688" style="stroke: none; stroke-width: 1.0;" width="1674.5" x="303.5" y="1456.3125"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="1230.4453" style="stroke: #000000; stroke-width: 2.0;" width="1655.5" x="303.5" y="1657.7813"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="197.9297" style="stroke: #000000; stroke-width: 2.0;" width="1604.5" x="323.5" y="1903.9766"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="765.3203" style="stroke: #000000; stroke-width: 2.0;" width="1635.5" x="313.5" y="2115.9063"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="182.7969" style="stroke: #000000; stroke-width: 2.0;" width="1615.5" x="323.5" y="2140.0391"/><rect fill="#FFFFFF" height="105.0703" style="stroke: none; stroke-width: 1.0;" width="1635.5" x="313.5" y="2776.1563"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="76.2656" style="stroke: #000000; stroke-width: 2.0;" width="1062" x="323.5" y="2797.9609"/><rect fill="#FFFFFF" height="53.9375" style="stroke: none; stroke-width: 1.0;" width="2003" x="23" y="2895.2266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="80" x2="80" y1="115.7266" y2="2973.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="401.5" x2="401.5" y1="115.7266" y2="2973.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1023.5" x2="1023.5" y1="115.7266" y2="2973.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1172.5" x2="1172.5" y1="115.7266" y2="2973.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1304.5" x2="1304.5" y1="115.7266" y2="2973.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1434.5" x2="1434.5" y1="115.7266" y2="2973.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1850.5" x2="1850.5" y1="115.7266" y2="2973.1641"/><rect fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="37" y="76.4297"/><rect fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="33" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="40" y="100.4248">Fulfil-Topic</text><rect fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="37" y="2972.1641"/><rect fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="33" y="2976.1641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="40" y="2996.1592">Fulfil-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="130" x="333.5" y="112.4248">Fulfil Event Handler</text><ellipse cx="401.5" cy="83.4297" fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="397.5,71.4297,403.5,66.4297,401.5,71.4297,403.5,76.4297,397.5,71.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="130" x="333.5" y="2985.1592">Fulfil Event Handler</text><ellipse cx="401.5" cy="3004.4609" fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="397.5,2992.4609,403.5,2987.4609,401.5,2992.4609,403.5,2997.4609,397.5,2992.4609" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="940.5" y="76.4297"/><rect fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="936.5" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="943.5" y="100.4248">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="940.5" y="2972.1641"/><rect fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="936.5" y="2976.1641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="943.5" y="2996.1592">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1124.5" y="76.4297"/><rect fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1120.5" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1127.5" y="100.4248">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1124.5" y="2972.1641"/><rect fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1120.5" y="2976.1641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1127.5" y="2996.1592">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="1238.5" y="76.4297"/><rect fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="1234.5" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="1241.5" y="100.4248">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="1238.5" y="2972.1641"/><rect fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="1234.5" y="2976.1641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="1241.5" y="2996.1592">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="1385.5" y="112.4248">Transfer DAO</text><ellipse cx="1434.5" cy="83.4297" fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1422.5" x2="1446.5" y1="97.4297" y2="97.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="1385.5" y="2985.1592">Transfer DAO</text><ellipse cx="1434.5" cy="3004.4609" fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1422.5" x2="1446.5" y1="3018.4609" y2="3018.4609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1802.5" y="112.4248">Central Store</text><path d="M1832.5,63.4297 C1832.5,53.4297 1850.5,53.4297 1850.5,53.4297 C1850.5,53.4297 1868.5,53.4297 1868.5,63.4297 L1868.5,89.4297 C1868.5,99.4297 1850.5,99.4297 1850.5,99.4297 C1850.5,99.4297 1832.5,99.4297 1832.5,89.4297 L1832.5,63.4297 " fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1832.5,63.4297 C1832.5,73.4297 1850.5,73.4297 1850.5,73.4297 C1850.5,73.4297 1868.5,73.4297 1868.5,63.4297 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1802.5" y="2985.1592">Central Store</text><path d="M1832.5,2998.4609 C1832.5,2988.4609 1850.5,2988.4609 1850.5,2988.4609 C1850.5,2988.4609 1868.5,2988.4609 1868.5,2998.4609 L1868.5,3024.4609 C1868.5,3034.4609 1850.5,3034.4609 1850.5,3034.4609 C1850.5,3034.4609 1832.5,3034.4609 1832.5,3024.4609 L1832.5,2998.4609 " fill="#FEFECE" filter="url(#f1rhjkxxcjlb7b)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1832.5,2998.4609 C1832.5,3008.4609 1850.5,3008.4609 1850.5,3008.4609 C1850.5,3008.4609 1868.5,3008.4609 1868.5,2998.4609 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="75.5" y="195.125"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="2837.4375" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="396.5" y="125.7266"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1018.5" y="2738.1563"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1300" y="2836.2266"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="150.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1429.5" y="677.25"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="135.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1429.5" y="938.5781"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="121.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1429.5" y="1507.3828"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1429.5" y="1711.1797"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="136.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1429.5" y="1957.375"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="770.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1429.5" y="2193.4375"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="92.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1845.5" y="706.3828"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="77.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1845.5" y="967.7109"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1845.5" y="1536.5156"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1845.5" y="1740.3125"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1845.5" y="1986.5078"/><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1845.5" y="2222.5703"/><path d="M13,132.7266 L306,132.7266 L306,139.7266 L296,149.7266 L13,149.7266 L13,132.7266 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2823.4375" style="stroke: #000000; stroke-width: 2.0;" width="2023" x="13" y="132.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="248" x="28" y="145.7935">Fulfil Handler Consume (Success)</text><path d="M23,156.8594 L87,156.8594 L87,163.8594 L77,173.8594 L23,173.8594 L23,156.8594 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2792.3047" style="stroke: #000000; stroke-width: 2.0;" width="2003" x="23" y="156.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="38" y="169.9263">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="174" x="102" y="169.0698">[Consume Single Message]</text><polygon fill="#A80036" points="96.5,191.125,86.5,195.125,96.5,199.125,92.5,195.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="90.5" x2="395.5" y1="195.125" y2="195.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="102.5" y="190.0591">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="115.5" y="190.0591">Consume Prepare event message for Payer</text><path d="M313.5,240.125 L401.5,240.125 L401.5,247.125 L391.5,257.125 L313.5,257.125 L313.5,240.125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="105.5313" style="stroke: #000000; stroke-width: 2.0;" width="505" x="313.5" y="240.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="328.5" y="253.1919">break</text><path d="M323.5,264.2578 L475.5,264.2578 L475.5,271.2578 L465.5,281.2578 L323.5,281.2578 L323.5,264.2578 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.3984" style="stroke: #000000; stroke-width: 2.0;" width="485" x="323.5" y="264.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="107" x="338.5" y="277.3247">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="448.5" y1="317.6563" y2="317.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448.5" x2="448.5" y1="317.6563" y2="330.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="407.5" x2="448.5" y1="330.6563" y2="330.6563"/><polygon fill="#A80036" points="417.5,326.6563,407.5,330.6563,417.5,334.6563,413.5,330.6563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="413.5" y="305.0239">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="426.5" y="297.4575">Validate event - Rule: type == 'fulfil' &amp;&amp; action == 'reject'</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="426.5" y="312.5903">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="520.5" y="312.5903">2001</text><path d="M323.5,359.6563 L555.5,359.6563 L555.5,366.6563 L545.5,376.6563 L323.5,376.6563 L323.5,359.6563 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="91.5313" style="stroke: #000000; stroke-width: 2.0;" width="911" x="323.5" y="359.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="338.5" y="372.7231">Persist Event Information</text><polygon fill="#A80036" points="1160.5,393.9219,1170.5,397.9219,1160.5,401.9219,1164.5,397.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="1166.5" y1="397.9219" y2="397.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="413.5" y="392.856">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="426.5" y="392.856">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="893" x="330.5" y="405.9219"/><polygon fill="#EEEEEE" points="330.5,405.9219,396.5,405.9219,396.5,412.9219,386.5,422.9219,330.5,422.9219,330.5,405.9219" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="343.5" y="419.9888">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="673.5" y="438.9888">Event Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="36" x="840.5" y="438.9888">9.1.0.</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="840.5" x2="876.5" y1="440.9888" y2="440.9888"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="876.5" y="438.9888">}</text><path d="M323.5,465.1875 L563.5,465.1875 L563.5,472.1875 L553.5,482.1875 L323.5,482.1875 L323.5,465.1875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="102.5313" style="stroke: #000000; stroke-width: 2.0;" width="1062" x="323.5" y="465.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="195" x="338.5" y="478.2544">Validate FSPIOP-Signature</text><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="1044" x="330.5" y="507.3203"/><polygon fill="#EEEEEE" points="330.5,507.3203,396.5,507.3203,396.5,514.3203,386.5,524.3203,330.5,524.3203,330.5,507.3203" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="343.5" y="521.3872">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="587" y="540.3872">Validate message.content.headers.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="129" x="815" y="540.3872">FSPIOP-Signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="948" y="540.3872">{</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-signature-validation.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-signature-validation.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="154" x="956" y="540.3872">seq-signature-validation</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="956" x2="1110" y1="542.3872" y2="542.3872"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1110" y="540.3872">}</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="587" y="555.52">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="681" y="555.52">2001</text><path d="M293.5,581.7188 L669.5,581.7188 L669.5,588.7188 L659.5,598.7188 L293.5,598.7188 L293.5,581.7188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1062.0625" style="stroke: #000000; stroke-width: 2.0;" width="1722.5" x="293.5" y="581.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="331" x="308.5" y="594.7856">Validate Transfer Fulfilment Duplicate Check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="448.5" y1="619.9844" y2="619.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448.5" x2="448.5" y1="619.9844" y2="632.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="407.5" x2="448.5" y1="632.9844" y2="632.9844"/><polygon fill="#A80036" points="417.5,628.9844,407.5,632.9844,417.5,636.9844,413.5,632.9844" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="413.5" y="614.9185">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="426.5" y="614.9185">Generate transferFulfilmentId uuid</text><polygon fill="#A80036" points="1417.5,673.25,1427.5,677.25,1417.5,681.25,1421.5,677.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="1423.5" y1="677.25" y2="677.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="413.5" y="664.6177">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="373" x="426.5" y="657.0513">Request to retrieve transfer fulfilment hashes by transferId</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="426.5" y="672.1841">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="512.5" y="672.1841">2003</text><polygon fill="#A80036" points="1833.5,702.3828,1843.5,706.3828,1833.5,710.3828,1837.5,706.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1439.5" x2="1839.5" y1="706.3828" y2="706.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1446.5" y="701.3169">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="346" x="1459.5" y="701.3169">Request Transfer fulfilment duplicate message hashes</text><polygon fill="#FFFFE0" filter="url(#f1rhjkxxcjlb7b)" points="1704,719.3828,1996,719.3828,2006,745.3828,1996,772.3828,1704,772.3828,1694,745.3828,1704,719.3828" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="1706" y="735.4497">SELET transferId, hash</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1706" y="750.5825">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="248" x="1746" y="750.5825">transferFulfilmentDuplicateCheck</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="1706" y="765.7153">WHERE transferId = request.params.id</text><polygon fill="#A80036" points="1450.5,794.9141,1440.5,798.9141,1450.5,802.9141,1446.5,798.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1444.5" x2="1849.5" y1="798.9141" y2="798.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1456.5" y="793.8481">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="1469.5" y="793.8481">Return existing hashes</text><polygon fill="#A80036" points="417.5,824.0469,407.5,828.0469,417.5,832.0469,413.5,828.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="411.5" x2="1433.5" y1="828.0469" y2="828.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="423.5" y="822.981">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="436.5" y="822.981">Return (list of) transfer fulfil messages hash(es)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="448.5" y1="857.1797" y2="857.1797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448.5" x2="448.5" y1="857.1797" y2="870.1797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="407.5" x2="448.5" y1="870.1797" y2="870.1797"/><polygon fill="#A80036" points="417.5,866.1797,407.5,870.1797,417.5,874.1797,413.5,870.1797" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="413.5" y="852.1138">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="585" x="426.5" y="852.1138">Loop the list of returned hashes and compare each entry with the calculated message hash</text><path d="M303.5,885.1797 L367.5,885.1797 L367.5,892.1797 L357.5,902.1797 L303.5,902.1797 L303.5,885.1797 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="751.6016" style="stroke: #000000; stroke-width: 2.0;" width="1674.5" x="303.5" y="885.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="318.5" y="898.2466">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="382.5" y="897.3901">[Hash matched]</text><polygon fill="#A80036" points="1417.5,934.5781,1427.5,938.5781,1417.5,942.5781,1421.5,938.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="1423.5" y1="938.5781" y2="938.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="413.5" y="925.9458">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="365" x="435.5" y="918.3794">Request to retrieve Transfer Fulfilment and Transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="435.5" y="933.5122">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="521.5" y="933.5122">2003</text><polygon fill="#A80036" points="1833.5,963.7109,1843.5,967.7109,1833.5,971.7109,1837.5,967.7109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1439.5" x2="1839.5" y1="967.7109" y2="967.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1446.5" y="962.645">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="365" x="1468.5" y="962.645">Request to retrieve Transfer Fulfilment and Transfer state</text><polygon fill="#FFFFE0" filter="url(#f1rhjkxxcjlb7b)" points="1781,980.7109,1919,980.7109,1929,999.7109,1919,1018.7109,1781,1018.7109,1771,999.7109,1781,980.7109" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="1783" y="996.7778">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="1783" y="1011.9106">transferStateChange</text><polygon fill="#A80036" points="1450.5,1041.1094,1440.5,1045.1094,1450.5,1049.1094,1446.5,1045.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1444.5" x2="1849.5" y1="1045.1094" y2="1045.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1456.5" y="1040.0435">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="1478.5" y="1040.0435">Return Transfer Fulfilment and Transfer state</text><polygon fill="#A80036" points="417.5,1070.2422,407.5,1074.2422,417.5,1078.2422,413.5,1074.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="411.5" x2="1433.5" y1="1074.2422" y2="1074.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="423.5" y="1069.1763">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="445.5" y="1069.1763">Return Transfer Fulfilment and Transfer state</text><path d="M313.5,1089.2422 L377.5,1089.2422 L377.5,1096.2422 L367.5,1106.2422 L313.5,1106.2422 L313.5,1089.2422 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="360.0703" style="stroke: #000000; stroke-width: 2.0;" width="1082" x="313.5" y="1089.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="328.5" y="1102.3091">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="392.5" y="1101.4526">[transferFulfilment.isValid == 0]</text><path d="M323.5,1113.375 L411.5,1113.375 L411.5,1120.375 L401.5,1130.375 L323.5,1130.375 L323.5,1113.375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="270" x="323.5" y="1113.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="338.5" y="1126.4419">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="448.5" y1="1151.6406" y2="1151.6406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448.5" x2="448.5" y1="1151.6406" y2="1164.6406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="407.5" x2="448.5" y1="1164.6406" y2="1164.6406"/><polygon fill="#A80036" points="417.5,1160.6406,407.5,1164.6406,417.5,1168.6406,413.5,1164.6406" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="413.5" y="1146.5747">14</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="435.5" y="1146.5747">Error handling:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="549.5" y="1146.5747">3105</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="313.5" x2="1395.5" y1="1180.6406" y2="1180.6406"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="284" x="318.5" y="1190.8511">[transferState IN ['COMMITTED', 'ABORTED']]</text><path d="M323.5,1201.4453 L411.5,1201.4453 L411.5,1208.4453 L401.5,1218.4453 L323.5,1218.4453 L323.5,1201.4453 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="77.5313" style="stroke: #000000; stroke-width: 2.0;" width="1062" x="323.5" y="1201.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="338.5" y="1214.5122">break</text><rect fill="#FFFFFF" filter="url(#f1rhjkxxcjlb7b)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="1044" x="330.5" y="1218.5781"/><polygon fill="#EEEEEE" points="330.5,1218.5781,396.5,1218.5781,396.5,1225.5781,386.5,1235.5781,330.5,1235.5781,330.5,1218.5781" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="343.5" y="1232.645">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="694" y="1251.645">Send notification to Participant (Payee) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="48" x="955" y="1251.645">1.1.4.a.</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="955" x2="1003" y1="1253.645" y2="1253.645"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1003" y="1251.645">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="698" y="1266.7778"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="313.5" x2="1395.5" y1="1286.9766" y2="1286.9766"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="201" x="318.5" y="1297.187">[transferState NOT 'RESERVED']</text><path d="M323.5,1307.7813 L411.5,1307.7813 L411.5,1314.7813 L401.5,1324.7813 L323.5,1324.7813 L323.5,1307.7813 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="242" x="323.5" y="1307.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="338.5" y="1320.8481">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="448.5" y1="1346.0469" y2="1346.0469"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448.5" x2="448.5" y1="1346.0469" y2="1359.0469"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="407.5" x2="448.5" y1="1359.0469" y2="1359.0469"/><polygon fill="#A80036" points="417.5,1355.0469,407.5,1359.0469,417.5,1363.0469,413.5,1359.0469" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="413.5" y="1340.981">15</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="435.5" y="1340.981">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="521.5" y="1340.981">2001</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="313.5" x2="1395.5" y1="1375.0469" y2="1375.0469"/><path d="M323.5,1383.0469 L411.5,1383.0469 L411.5,1390.0469 L401.5,1400.0469 L323.5,1400.0469 L323.5,1383.0469 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="348" x="323.5" y="1383.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="338.5" y="1396.1138">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="448.5" y1="1421.3125" y2="1421.3125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448.5" x2="448.5" y1="1421.3125" y2="1434.3125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="407.5" x2="448.5" y1="1434.3125" y2="1434.3125"/><polygon fill="#A80036" points="417.5,1430.3125,407.5,1434.3125,417.5,1438.3125,413.5,1434.3125" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="413.5" y="1416.2466">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="435.5" y="1416.2466">Allow previous request to complete</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="303.5" x2="1978" y1="1457.3125" y2="1457.3125"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="126" x="308.5" y="1467.5229">[Hash not matched]</text><polygon fill="#A80036" points="1417.5,1503.3828,1427.5,1507.3828,1417.5,1511.3828,1421.5,1507.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="1423.5" y1="1507.3828" y2="1507.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="413.5" y="1494.7505">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="435.5" y="1487.1841">Request to persist transfer hash</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="435.5" y="1502.3169">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="529.5" y="1502.3169">2003</text><polygon fill="#A80036" points="1833.5,1532.5156,1843.5,1536.5156,1833.5,1540.5156,1837.5,1536.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1439.5" x2="1839.5" y1="1536.5156" y2="1536.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1446.5" y="1531.4497">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="1468.5" y="1531.4497">Persist hash</text><polygon fill="#FFFFE0" filter="url(#f1rhjkxxcjlb7b)" points="1743,1579.5156,1958,1579.5156,1968,1590.5156,1958,1602.5156,1743,1602.5156,1733,1590.5156,1743,1579.5156" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="1745" y="1595.5825">transferFulfilmentDuplicateCheck</text><polygon fill="#A80036" points="417.5,1624.7813,407.5,1628.7813,417.5,1632.7813,413.5,1628.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="411.5" x2="1433.5" y1="1628.7813" y2="1628.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="423.5" y="1623.7153">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="445.5" y="1623.7153">Return success</text><path d="M303.5,1657.7813 L643.5,1657.7813 L643.5,1664.7813 L633.5,1674.7813 L303.5,1674.7813 L303.5,1657.7813 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1230.4453" style="stroke: #000000; stroke-width: 2.0;" width="1655.5" x="303.5" y="1657.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="295" x="318.5" y="1670.8481">Validate and persist Transfer Fulfilment</text><polygon fill="#A80036" points="1417.5,1707.1797,1427.5,1711.1797,1417.5,1715.1797,1421.5,1711.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="1423.5" y1="1711.1797" y2="1711.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="413.5" y="1698.5474">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="435.5" y="1690.981">Request information for the validate checks</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="435.5" y="1706.1138">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="521.5" y="1706.1138">2003</text><polygon fill="#A80036" points="1833.5,1736.3125,1843.5,1740.3125,1833.5,1744.3125,1837.5,1740.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1439.5" x2="1839.5" y1="1740.3125" y2="1740.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1446.5" y="1735.2466">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="1468.5" y="1735.2466">Fetch from database</text><polygon fill="#FFFFE0" filter="url(#f1rhjkxxcjlb7b)" points="1823,1753.3125,1877,1753.3125,1887,1764.3125,1877,1776.3125,1823,1776.3125,1813,1764.3125,1823,1753.3125" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="1825" y="1769.3794">transfer</text><polygon fill="#A80036" points="1450.5,1798.5781,1440.5,1802.5781,1450.5,1806.5781,1446.5,1802.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1444.5" x2="1849.5" y1="1802.5781" y2="1802.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1456.5" y="1797.5122">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1482.5" y="1797.5122"/><polygon fill="#A80036" points="417.5,1827.7109,407.5,1831.7109,417.5,1835.7109,413.5,1831.7109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="411.5" x2="1433.5" y1="1831.7109" y2="1831.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="423.5" y="1826.645">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="445.5" y="1826.645">Return transfer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="448.5" y1="1875.9766" y2="1875.9766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448.5" x2="448.5" y1="1875.9766" y2="1888.9766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="407.5" x2="448.5" y1="1888.9766" y2="1888.9766"/><polygon fill="#A80036" points="417.5,1884.9766,407.5,1888.9766,417.5,1892.9766,413.5,1888.9766" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="413.5" y="1863.3442">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="472" x="435.5" y="1855.7778">Validate that Transfer.ilpCondition = SHA-256 (content.payload.fulfilment)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="435.5" y="1870.9106">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="521.5" y="1870.9106">2001</text><path d="M323.5,1903.9766 L495.5,1903.9766 L495.5,1910.9766 L485.5,1920.9766 L323.5,1920.9766 L323.5,1903.9766 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="197.9297" style="stroke: #000000; stroke-width: 2.0;" width="1604.5" x="323.5" y="1903.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="127" x="338.5" y="1917.0435">Persist fulfilment</text><polygon fill="#A80036" points="1417.5,1953.375,1427.5,1957.375,1417.5,1961.375,1421.5,1957.375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="1423.5" y1="1957.375" y2="1957.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="413.5" y="1944.7427">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="496" x="435.5" y="1937.1763">Persist fulfilment with the result of the above check (transferFulfilment.isValid)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="435.5" y="1952.3091">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="521.5" y="1952.3091">2003</text><polygon fill="#A80036" points="1833.5,1982.5078,1843.5,1986.5078,1833.5,1990.5078,1837.5,1986.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1439.5" x2="1839.5" y1="1986.5078" y2="1986.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1446.5" y="1981.4419">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="1468.5" y="1981.4419">Persist to database</text><polygon fill="#FFFFE0" filter="url(#f1rhjkxxcjlb7b)" points="1792,2029.5078,1908,2029.5078,1918,2048.5078,1908,2067.5078,1792,2067.5078,1782,2048.5078,1792,2029.5078" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="1794" y="2045.5747">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="1794" y="2060.7075">transferExtension</text><polygon fill="#A80036" points="417.5,2089.9063,407.5,2093.9063,417.5,2097.9063,413.5,2093.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="411.5" x2="1433.5" y1="2093.9063" y2="2093.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="423.5" y="2088.8403">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="445.5" y="2088.8403">Return success</text><path d="M313.5,2115.9063 L377.5,2115.9063 L377.5,2122.9063 L367.5,2132.9063 L313.5,2132.9063 L313.5,2115.9063 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="765.3203" style="stroke: #000000; stroke-width: 2.0;" width="1635.5" x="313.5" y="2115.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="328.5" y="2128.9731">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="274" x="392.5" y="2128.1167">[Transfer.ilpCondition validate successful]</text><path d="M323.5,2140.0391 L769.5,2140.0391 L769.5,2147.0391 L759.5,2157.0391 L323.5,2157.0391 L323.5,2140.0391 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="182.7969" style="stroke: #000000; stroke-width: 2.0;" width="1615.5" x="323.5" y="2140.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="401" x="338.5" y="2153.106">Persist Transfer State (with transferState='REJECTED')</text><polygon fill="#A80036" points="1417.5,2189.4375,1427.5,2193.4375,1417.5,2197.4375,1421.5,2193.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="1423.5" y1="2193.4375" y2="2193.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="413.5" y="2180.8052">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="207" x="435.5" y="2173.2388">Request to persist transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="435.5" y="2188.3716">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="521.5" y="2188.3716">2003</text><polygon fill="#A80036" points="1833.5,2218.5703,1843.5,2222.5703,1833.5,2226.5703,1837.5,2222.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1439.5" x2="1839.5" y1="2222.5703" y2="2222.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1446.5" y="2217.5044">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="1468.5" y="2217.5044">Persist transfer state</text><polygon fill="#FFFFE0" filter="url(#f1rhjkxxcjlb7b)" points="1781,2265.5703,1919,2265.5703,1929,2276.5703,1919,2288.5703,1781,2288.5703,1771,2276.5703,1781,2265.5703" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="1783" y="2281.6372">transferStateChange</text><polygon fill="#A80036" points="417.5,2310.8359,407.5,2314.8359,417.5,2318.8359,413.5,2314.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="411.5" x2="1428.5" y1="2314.8359" y2="2314.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="423.5" y="2309.77">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="445.5" y="2309.77">Return success</text><path d="M411,2334.8359 L411,2707.8359 L726,2707.8359 L726,2344.8359 L716,2334.8359 L411,2334.8359 " fill="#FFFF00" filter="url(#f1rhjkxxcjlb7b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M716,2334.8359 L716,2344.8359 L726,2344.8359 L716,2334.8359 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="417" y="2351.9028">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="417" y="2367.0356">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="433" y="2382.1685">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="267" x="433" y="2397.3013">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="433" y="2412.4341">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="433" y="2427.5669">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="433" y="2442.6997">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="449" y="2457.8325">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="449" y="2472.9653">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="433" y="2488.0981">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="433" y="2503.231">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="449" y="2518.3638">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="465" y="2533.4966">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="465" y="2548.6294">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="465" y="2563.7622">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="465" y="2578.895">action: reject,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="465" y="2594.0278">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="465" y="2609.1606">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="481" y="2624.2935">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="481" y="2639.4263">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="465" y="2654.5591">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="449" y="2669.6919">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="433" y="2684.8247">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="417" y="2699.9575">}</text><polygon fill="#A80036" points="1006.5,2734.1563,1016.5,2738.1563,1006.5,2742.1563,1010.5,2738.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="1012.5" y1="2738.1563" y2="2738.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="413.5" y="2733.0903">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="435.5" y="2733.0903">Route &amp; Publish Position event for Payee</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="313.5" x2="1949" y1="2777.1563" y2="2777.1563"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="255" x="318.5" y="2787.3667">[Validate Fulfil Transfer not successful]</text><path d="M323.5,2797.9609 L411.5,2797.9609 L411.5,2804.9609 L401.5,2814.9609 L323.5,2814.9609 L323.5,2797.9609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="76.2656" style="stroke: #000000; stroke-width: 2.0;" width="1062" x="323.5" y="2797.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="338.5" y="2811.0278">break</text><polygon fill="#A80036" points="1288,2832.2266,1298,2836.2266,1288,2840.2266,1292,2836.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="1294" y1="2836.2266" y2="2836.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="413.5" y="2831.1606">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="435.5" y="2831.1606">Route &amp; Publish Notification event for Payee</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="2026" y1="2896.2266" y2="2896.2266"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="28" y="2906.437">[Consume Batch Messages]</text><path d="M172,2915.0313 L172,2940.0313 L387,2940.0313 L387,2925.0313 L377,2915.0313 L172,2915.0313 " fill="#ADD8E6" filter="url(#f1rhjkxxcjlb7b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M377,2915.0313 L377,2925.0313 L387,2925.0313 L377,2915.0313 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="178" y="2932.0981">To be delivered by future story</text><!--
@startuml


title 2.1.1. Fulfil Handler Consume (Reject)
autonumber
collections "Fulfil-Topic" as TOPIC_FULFIL
control "Fulfil Event Handler" as FULF_HANDLER
collections "Event-Topic" as TOPIC_EVENT
collections "topic-transfer-position" as TOPIC_TRANSFER_POSITION
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Transfer DAO" as TRANS_DAO
database "Central Store" as DB
box "Central Service" #LightYellow
    participant TOPIC_FULFIL
    participant FULF_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant TOPIC_EVENT
    participant TOPIC_NOTIFICATIONS
    participant TRANS_DAO
    participant DB
end box
activate FULF_HANDLER
group Fulfil Handler Consume (Success)
    alt Consume Single Message
        TOPIC_FULFIL <- FULF_HANDLER: Consume Prepare event message for Payer
        activate TOPIC_FULFIL
        deactivate TOPIC_FULFIL
        break
            group Validate Event
                FULF_HANDLER <-> FULF_HANDLER: Validate event - Rule: type == 'fulfil' && action == 'reject'\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end
        group Persist Event Information
            FULF_HANDLER -> TOPIC_EVENT: Publish event information
            ref over FULF_HANDLER, TOPIC_EVENT:  Event Handler Consume {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-event-9.1.0.svg 9.1.0.]]}
        end
        group Validate FSPIOP-Signature
            |||
            ref over FULF_HANDLER, TOPIC_NOTIFICATIONS: Validate message.content.headers.**FSPIOP-Signature** {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-signature-validation.svg seq-signature-validation]]} \n<color #FF0000><b>Error codes:</b> 2001</color>
        end
        group Validate Transfer Fulfilment Duplicate Check
            FULF_HANDLER -> FULF_HANDLER: Generate transferFulfilmentId uuid
            FULF_HANDLER -> TRANS_DAO: Request to retrieve transfer fulfilment hashes by transferId\n<color #FF0000><b>Error code:</b> 2003</color>
            activate TRANS_DAO
            TRANS_DAO -> DB: Request Transfer fulfilment duplicate message hashes
            hnote over DB #lightyellow
                SELET transferId, hash
                FROM **transferFulfilmentDuplicateCheck**
                WHERE transferId = request.params.id
            end note
            activate DB
            TRANS_DAO <- - DB: Return existing hashes
            deactivate DB
            TRANS_DAO - -> FULF_HANDLER: Return (list of) transfer fulfil messages hash(es)
            deactivate TRANS_DAO
            FULF_HANDLER -> FULF_HANDLER: Loop the list of returned hashes and compare each entry with the calculated message hash
            alt Hash matched
                FULF_HANDLER -> TRANS_DAO: Request to retrieve Transfer Fulfilment and Transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                activate TRANS_DAO
                TRANS_DAO -> DB: Request to retrieve Transfer Fulfilment and Transfer state
                hnote over DB #lightyellow
                    transferFulfilment
                    transferStateChange
                end note
                activate DB
                TRANS_DAO <- - DB: Return Transfer Fulfilment and Transfer state
                deactivate DB
                TRANS_DAO - -> FULF_HANDLER: Return Transfer Fulfilment and Transfer state
                deactivate TRANS_DAO
                alt transferFulfilment.isValid == 0
                    break
                        FULF_HANDLER <-> FULF_HANDLER: <color #FF0000><b>Error handling:</b> 3105</color>
                    end
                else transferState IN ['COMMITTED', 'ABORTED']
                    break
                        ref over FULF_HANDLER, TOPIC_NOTIFICATIONS: Send notification to Participant (Payee) {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg 1.1.4.a.]]} \n
                    end
                else transferState NOT 'RESERVED'
                    break
                        FULF_HANDLER <-> FULF_HANDLER: <color #FF0000><b>Error code:</b> 2001</color>
                    end
                else
                    break
                        FULF_HANDLER <-> FULF_HANDLER: Allow previous request to complete
                    end
                end
            else Hash not matched
                FULF_HANDLER -> TRANS_DAO: Request to persist transfer hash\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist hash
                hnote over DB #lightyellow
                    transferFulfilmentDuplicateCheck
                end note
                activate DB
                deactivate DB
                TRANS_DAO - -> FULF_HANDLER: Return success
                deactivate TRANS_DAO
            end
        end
        group Validate and persist Transfer Fulfilment
            FULF_HANDLER -> TRANS_DAO: Request information for the validate checks\n<color #FF0000><b>Error code:</b> 2003</color>
            activate TRANS_DAO
            TRANS_DAO -> DB: Fetch from database
            activate DB
            hnote over DB #lightyellow
                transfer
            end note
            DB - -> TRANS_DAO
            deactivate DB
            FULF_HANDLER <- - TRANS_DAO: Return transfer
            deactivate TRANS_DAO
            FULF_HANDLER ->FULF_HANDLER: Validate that Transfer.ilpCondition = SHA-256 (content.payload.fulfilment)\n<color #FF0000><b>Error code:</b> 2001</color>

            group Persist fulfilment
                FULF_HANDLER -> TRANS_DAO: Persist fulfilment with the result of the above check (transferFulfilment.isValid)\n<color #FF0000><b>Error code:</b> 2003</color>
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist to database
                activate DB
                deactivate DB
                hnote over DB #lightyellow
                    transferFulfilment
                    transferExtension
                end note
                FULF_HANDLER <- - TRANS_DAO: Return success
                deactivate TRANS_DAO
            end

            alt Transfer.ilpCondition validate successful
                group Persist Transfer State (with transferState='REJECTED')
                    FULF_HANDLER -> TRANS_DAO: Request to persist transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate TRANS_DAO
                    TRANS_DAO -> DB: Persist transfer state
                    activate DB
                    hnote over DB #lightyellow
                        transferStateChange
                    end note
                    deactivate DB
                    TRANS_DAO - -> FULF_HANDLER: Return success
                end

                note right of FULF_HANDLER #yellow
                    Message:
                    {
                        id: <ID>,
                        from: <transferHeaders.FSPIOP-Source>,
                        to: <transferHeaders.FSPIOP-Destination>,
                        type: application/json,
                        content: {
                            headers: <transferHeaders>,
                            payload: <transferMessage>
                        },
                        metadata: {
                            event: {
                                id: <uuid>,
                                responseTo: <previous.uuid>,
                                type: position,
                                action: reject,
                                createdAt: <timestamp>,
                                state: {
                                    status: "success",
                                    code: 0
                                }
                            }
                        }
                    }
                end note

                FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Route & Publish Position event for Payee
                activate TOPIC_TRANSFER_POSITION
                deactivate TOPIC_TRANSFER_POSITION
            else Validate Fulfil Transfer not successful
                break
                    FULF_HANDLER -> TOPIC_NOTIFICATIONS: Route & Publish Notification event for Payee
                    activate TOPIC_NOTIFICATIONS
                    deactivate TOPIC_NOTIFICATIONS
                end
            end
        end
    else Consume Batch Messages
        note left of FULF_HANDLER #lightblue
            To be delivered by future story
        end note
    end
end
deactivate FULF_HANDLER
@enduml

PlantUML version 1.2019.00(Sun Jan 13 15:46:42 UTC 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>