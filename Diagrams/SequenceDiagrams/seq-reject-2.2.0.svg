<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2080px" preserveAspectRatio="none" style="width:2612px;height:2080px;" version="1.1" viewBox="0 0 2612 2080" width="2612px" zoomAndPan="magnify"><defs><filter height="300%" id="f113h6la0zwzd6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="403" x="1105.75" y="22.9951">2.2.0. DFSP2 sends a Fulfil Reject Transfer request</text><rect fill="#D3D3D3" height="2035.3438" style="stroke: #A80036; stroke-width: 1.0;" width="204" x="4" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="198" x="7" y="46.3638">Financial Service Providers</text><rect fill="#ADD8E6" height="2035.3438" style="stroke: #A80036; stroke-width: 1.0;" width="568" x="416" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173" x="613.5" y="46.3638">ML API Adapter Service</text><rect fill="#FFFFE0" height="2035.3438" style="stroke: #A80036; stroke-width: 1.0;" width="1599.5" x="986" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="1730.25" y="46.3638">Central Service</text><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="543.7188" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="469" y="767.5391"/><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="1795.0234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="860" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="71.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1176.5" y="1210.8594"/><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="1795.0234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1542.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="1795.0234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1999" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="1795.0234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2340" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="1780.0234" style="stroke: #000000; stroke-width: 2.0;" width="2572.5" x="29" y="170.0234"/><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="131.6641" style="stroke: #000000; stroke-width: 2.0;" width="2552.5" x="39" y="1786.3828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="75" x2="75" y1="153.0234" y2="1967.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="137" x2="137" y1="153.0234" y2="1967.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="474" x2="474" y1="153.0234" y2="1967.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="865" x2="865" y1="153.0234" y2="1967.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1057" x2="1057" y1="153.0234" y2="1967.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1181" x2="1181" y1="153.0234" y2="1967.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1547.5" x2="1547.5" y1="153.0234" y2="1967.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1712.5" x2="1712.5" y1="153.0234" y2="1967.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1861.5" x2="1861.5" y1="153.0234" y2="1967.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2003.5" x2="2003.5" y1="153.0234" y2="1967.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2170" x2="2170" y1="153.0234" y2="1967.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2344.5" x2="2344.5" y1="153.0234" y2="1967.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2510.5" x2="2510.5" y1="153.0234" y2="1967.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="49" y="133.4248">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="53" y="149.7217">Payer</text><ellipse cx="75" cy="63.4297" fill="#FEFECE" filter="url(#f113h6la0zwzd6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M75,71.4297 L75,98.4297 M62,79.4297 L88,79.4297 M75,98.4297 L62,113.4297 M75,98.4297 L88,113.4297 " fill="none" filter="url(#f113h6la0zwzd6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="49" y="1979.042">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="53" y="1995.3389">Payer</text><ellipse cx="75" cy="2008.6406" fill="#FEFECE" filter="url(#f113h6la0zwzd6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M75,2016.6406 L75,2043.6406 M62,2024.6406 L88,2024.6406 M75,2043.6406 L62,2058.6406 M75,2043.6406 L88,2058.6406 " fill="none" filter="url(#f113h6la0zwzd6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="111" y="133.4248">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="113" y="149.7217">Payee</text><ellipse cx="137" cy="63.4297" fill="#FEFECE" filter="url(#f113h6la0zwzd6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M137,71.4297 L137,98.4297 M124,79.4297 L150,79.4297 M137,98.4297 L124,113.4297 M137,98.4297 L150,113.4297 " fill="none" filter="url(#f113h6la0zwzd6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="111" y="1979.042">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="113" y="1995.3389">Payee</text><ellipse cx="137" cy="2008.6406" fill="#FEFECE" filter="url(#f113h6la0zwzd6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M137,2016.6406 L137,2043.6406 M124,2024.6406 L150,2024.6406 M137,2043.6406 L124,2058.6406 M137,2043.6406 L150,2058.6406 " fill="none" filter="url(#f113h6la0zwzd6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="420" y="149.7217">ML API Adapter</text><path d="M453.5,108.7266 L453.5,132.7266 M453.5,120.7266 L470.5,120.7266 " fill="none" filter="url(#f113h6la0zwzd6)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="482.5" cy="120.7266" fill="#FEFECE" filter="url(#f113h6la0zwzd6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="420" y="1979.042">ML API Adapter</text><path d="M453.5,1986.3438 L453.5,2010.3438 M453.5,1998.3438 L470.5,1998.3438 " fill="none" filter="url(#f113h6la0zwzd6)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="482.5" cy="1998.3438" fill="#FEFECE" filter="url(#f113h6la0zwzd6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="224" x="750" y="149.7217">ML API Notification Event Handler</text><ellipse cx="865" cy="120.7266" fill="#FEFECE" filter="url(#f113h6la0zwzd6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="861,108.7266,867,103.7266,865,108.7266,867,113.7266,861,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="224" x="750" y="1979.042">ML API Notification Event Handler</text><ellipse cx="865" cy="1998.3438" fill="#FEFECE" filter="url(#f113h6la0zwzd6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="861,1986.3438,867,1981.3438,865,1986.3438,867,1991.3438,861,1986.3438" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="990" y="149.7217">Central Service API</text><path d="M1036.5,108.7266 L1036.5,132.7266 M1036.5,120.7266 L1053.5,120.7266 " fill="none" filter="url(#f113h6la0zwzd6)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1065.5" cy="120.7266" fill="#FEFECE" filter="url(#f113h6la0zwzd6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="990" y="1979.042">Central Service API</text><path d="M1036.5,1986.3438 L1036.5,2010.3438 M1036.5,1998.3438 L1053.5,1998.3438 " fill="none" filter="url(#f113h6la0zwzd6)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1065.5" cy="1998.3438" fill="#FEFECE" filter="url(#f113h6la0zwzd6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="1138" y="113.7266"/><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="1134" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="1141" y="137.7217">Fulfil-Topic</text><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="1138" y="1966.0469"/><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="1134" y="1970.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="1141" y="1990.042">Fulfil-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="130" x="1479.5" y="149.7217">Fulfil Event Handler</text><ellipse cx="1547.5" cy="120.7266" fill="#FEFECE" filter="url(#f113h6la0zwzd6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1543.5,108.7266,1549.5,103.7266,1547.5,108.7266,1549.5,113.7266,1543.5,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="130" x="1479.5" y="1979.042">Fulfil Event Handler</text><ellipse cx="1547.5" cy="1998.3438" fill="#FEFECE" filter="url(#f113h6la0zwzd6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1543.5,1986.3438,1549.5,1981.3438,1547.5,1986.3438,1549.5,1991.3438,1543.5,1986.3438" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="1629.5" y="113.7266"/><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="1625.5" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1632.5" y="137.7217">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="1629.5" y="1966.0469"/><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="1625.5" y="1970.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1632.5" y="1990.042">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1813.5" y="113.7266"/><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1809.5" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1816.5" y="137.7217">Event-Topic</text><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1813.5" y="1966.0469"/><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1809.5" y="1970.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1816.5" y="1990.042">Event-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="1923.5" y="149.7217">Position Event Handler</text><ellipse cx="2004" cy="120.7266" fill="#FEFECE" filter="url(#f113h6la0zwzd6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2000,108.7266,2006,103.7266,2004,108.7266,2006,113.7266,2000,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="1923.5" y="1979.042">Position Event Handler</text><ellipse cx="2004" cy="1998.3438" fill="#FEFECE" filter="url(#f113h6la0zwzd6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2000,1986.3438,2006,1981.3438,2004,1986.3438,2006,1991.3438,2000,1986.3438" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="2113" y="113.7266"/><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="2109" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="2116" y="137.7217">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="2113" y="1966.0469"/><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="2109" y="1970.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="2116" y="1990.042">Transfer-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2263.5" y="149.7217">Transfer Event Handler</text><ellipse cx="2345" cy="120.7266" fill="#FEFECE" filter="url(#f113h6la0zwzd6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2341,108.7266,2347,103.7266,2345,108.7266,2347,113.7266,2341,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2263.5" y="1979.042">Transfer Event Handler</text><ellipse cx="2345" cy="1998.3438" fill="#FEFECE" filter="url(#f113h6la0zwzd6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2341,1986.3438,2347,1981.3438,2345,1986.3438,2347,1991.3438,2341,1986.3438" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="2444.5" y="113.7266"/><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="2440.5" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="2447.5" y="137.7217">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="2444.5" y="1966.0469"/><rect fill="#FEFECE" filter="url(#f113h6la0zwzd6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="2440.5" y="1970.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="2447.5" y="1990.042">Notification-Topic</text><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="543.7188" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="469" y="767.5391"/><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="1795.0234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="860" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="71.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1176.5" y="1210.8594"/><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="1795.0234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1542.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="1795.0234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1999" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="1795.0234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2340" y="163.0234"/><path d="M29,170.0234 L405,170.0234 L405,177.0234 L395,187.0234 L29,187.0234 L29,170.0234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1780.0234" style="stroke: #000000; stroke-width: 2.0;" width="2572.5" x="29" y="170.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="331" x="44" y="183.0903">DFSP2 sends a Fulfil Reject Transfer request</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="137" x2="179" y1="238.5547" y2="238.5547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="179" x2="179" y1="238.5547" y2="251.5547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="138" x2="179" y1="251.5547" y2="251.5547"/><polygon fill="#A80036" points="148,247.5547,138,251.5547,148,255.5547,144,251.5547" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="144" y="218.356">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="157" y="203.2231">Retrieve fulfilment string generated during</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="157" y="218.356">the quoting process or regenerate it using</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="157" y="233.4888">Local secret</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="250" y="233.4888">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="278" y="233.4888">ILP Packet</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="360" y="233.4888">as inputs</text><path d="M142,264.5547 L142,682.5547 L479,682.5547 L479,274.5547 L469,264.5547 L142,264.5547 " fill="#FFFF00" filter="url(#f113h6la0zwzd6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M469,264.5547 L469,274.5547 L479,274.5547 L469,264.5547 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="148" y="281.6216">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="164" y="296.7544">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="164" y="311.8872">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="164" y="327.02">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="164" y="342.1528">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="164" y="357.2856">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="164" y="372.4185">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="164" y="387.5513">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="164" y="402.6841">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="164" y="417.8169">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="300" x="164" y="432.9497">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="148" y="448.0825">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="152" y="463.2153"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="148" y="478.3481">Payload - transferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="148" y="493.481">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="164" y="508.6138">"fulfilment": &lt;IlpFulfilment&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="164" y="523.7466">"completedTimestamp": &lt;DateTime&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="164" y="538.8794">"transferState":</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="267" y="538.8794">"ABORTED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="338" y="538.8794">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="164" y="554.0122"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="164" y="554.0122">"extensionList":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="266" y="554.0122">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="180" y="569.145">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="196" y="584.2778">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="212" y="599.4106">"key": &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="212" y="614.5435">"value": &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="196" y="629.6763">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="180" y="644.8091">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="164" y="659.9419">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="148" y="675.0747">}</text><path d="M142,697.1406 L142,737.1406 L479,737.1406 L479,707.1406 L469,697.1406 L142,697.1406 " fill="#D3D3D3" filter="url(#f113h6la0zwzd6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M469,697.1406 L469,707.1406 L479,707.1406 L469,697.1406 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="148" y="714.2075">Note</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="183" y="714.2075">: Payee rejection reason should be captured</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="148" y="729.3403">in the extensionList within the payload.</text><polygon fill="#A80036" points="457,763.5391,467,767.5391,457,771.5391,461,767.5391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="137" x2="463" y1="767.5391" y2="767.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="144" y="762.4731">2</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="157" y="762.4731">PUT - /transfers/&lt;ID&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="479" x2="521" y1="796.6719" y2="796.6719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="521" x2="521" y1="796.6719" y2="809.6719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="480" x2="521" y1="809.6719" y2="809.6719"/><polygon fill="#A80036" points="490,805.6719,480,809.6719,490,813.6719,486,809.6719" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="486" y="791.606">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="354" x="499" y="791.606">Validate incoming token and originator matching Payee</text><path d="M484,822.6719 L484,1180.6719 L799,1180.6719 L799,832.6719 L789,822.6719 L484,822.6719 " fill="#FFFF00" filter="url(#f113h6la0zwzd6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M789,822.6719 L789,832.6719 L799,832.6719 L789,822.6719 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="490" y="839.7388">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="490" y="854.8716">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="506" y="870.0044">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="267" x="506" y="885.1372">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="506" y="900.27">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="506" y="915.4028">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="506" y="930.5356">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="522" y="945.6685">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="522" y="960.8013">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="506" y="975.9341">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="506" y="991.0669">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="522" y="1006.1997">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="538" y="1021.3325">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="538" y="1036.4653">type: fulfil,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="538" y="1051.5981">action: reject,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="538" y="1066.731">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="538" y="1081.8638">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="554" y="1096.9966">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="554" y="1112.1294">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="538" y="1127.2622">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="522" y="1142.395">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="506" y="1157.5278">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="490" y="1172.6606">}</text><polygon fill="#A80036" points="1164.5,1206.8594,1174.5,1210.8594,1164.5,1214.8594,1168.5,1210.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="479" x2="1170.5" y1="1210.8594" y2="1210.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="486" y="1205.7935">4</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="281" x="499" y="1205.7935">Route &amp; Publish Fulfil event for Payee</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1186.5" x2="1228.5" y1="1239.9922" y2="1239.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1228.5" x2="1228.5" y1="1239.9922" y2="1252.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1187.5" x2="1228.5" y1="1252.9922" y2="1252.9922"/><polygon fill="#A80036" points="1197.5,1248.9922,1187.5,1252.9922,1197.5,1256.9922,1193.5,1252.9922" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1193.5" y="1234.9263">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="329" x="1206.5" y="1234.9263">Ensure event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="490,1278.125,480,1282.125,490,1286.125,486,1282.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="484" x2="1180.5" y1="1282.125" y2="1282.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="496" y="1277.0591">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="381" x="509" y="1277.0591">Respond replication acknowledgements have been received</text><polygon fill="#A80036" points="148,1307.2578,138,1311.2578,148,1315.2578,144,1311.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="142" x2="473" y1="1311.2578" y2="1311.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="154" y="1306.1919">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="167" y="1306.1919">Respond HTTP - 200 (OK)</text><polygon fill="#A80036" points="1192.5,1336.3906,1182.5,1340.3906,1192.5,1344.3906,1188.5,1340.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1186.5" x2="1541.5" y1="1340.3906" y2="1340.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1198.5" y="1335.3247">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="1211.5" y="1335.3247">Consume message</text><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="781.5" x="1131" y="1348.3906"/><polygon fill="#EEEEEE" points="1131,1348.3906,1197,1348.3906,1197,1355.3906,1187,1365.3906,1131,1365.3906,1131,1348.3906" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="1144" y="1362.4575">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="1393.75" y="1381.4575">Fulfil Handler Consume (Reject) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-reject-2.2.1.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-reject-2.2.1.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="36" x="1605.75" y="1381.4575">2.2.1.</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1605.75" x2="1641.75" y1="1383.4575" y2="1383.4575"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1641.75" y="1381.4575">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1397.75" y="1396.5903"/><polygon fill="#A80036" points="1700.5,1425.9219,1710.5,1429.9219,1700.5,1433.9219,1704.5,1429.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1552.5" x2="1706.5" y1="1429.9219" y2="1429.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1559.5" y="1424.856">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="1572.5" y="1424.856">Produce message</text><polygon fill="#A80036" points="1723.5,1480.0547,1713.5,1484.0547,1723.5,1488.0547,1719.5,1484.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1717.5" x2="1998" y1="1484.0547" y2="1484.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1729.5" y="1478.9888">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="1751.5" y="1478.9888">Consume message</text><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="607.5" x="1622.5" y="1492.0547"/><polygon fill="#EEEEEE" points="1622.5,1492.0547,1688.5,1492.0547,1688.5,1499.0547,1678.5,1509.0547,1622.5,1509.0547,1622.5,1492.0547" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="1635.5" y="1506.1216">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="1728.25" y="1525.1216">Position Handler Consume (Reject) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-position-1.3.3-abort.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-position-1.3.3-abort.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="154" x="1962.25" y="1525.1216">seq-position-1.3.3-abort</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1962.25" x2="2116.25" y1="1527.1216" y2="1527.1216"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="2116.25" y="1525.1216">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1732.25" y="1540.2544"/><polygon fill="#A80036" points="2158,1569.5859,2168,1573.5859,2158,1577.5859,2162,1573.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2009" x2="2164" y1="1573.5859" y2="1573.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2016" y="1568.52">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="2038" y="1568.52">Produce message</text><polygon fill="#A80036" points="2181,1623.7188,2171,1627.7188,2181,1631.7188,2177,1627.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2175" x2="2339" y1="1627.7188" y2="1627.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2187" y="1622.6528">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="2209" y="1622.6528">Consume message</text><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="774" x="1806.5" y="1635.7188"/><polygon fill="#EEEEEE" points="1806.5,1635.7188,1872.5,1635.7188,1872.5,1642.7188,1862.5,1652.7188,1806.5,1652.7188,1806.5,1635.7188" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="1819.5" y="1649.7856">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="2053.5" y="1668.7856">Transfer Handler Consume (Reject) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-reject-2.2.3.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-reject-2.2.3.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="36" x="2289.5" y="1668.7856">2.2.3.</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2289.5" x2="2325.5" y1="1670.7856" y2="1670.7856"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="2325.5" y="1668.7856">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="2057.5" y="1683.9185"/><polygon fill="#A80036" points="2499,1713.25,2509,1717.25,2499,1721.25,2503,1717.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2350" x2="2505" y1="1717.25" y2="1717.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2357" y="1712.1841">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="2379" y="1712.1841">Produce message</text><polygon fill="#A80036" points="2499,1767.3828,2509,1771.3828,2499,1775.3828,2503,1771.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="870" x2="2505" y1="1771.3828" y2="1771.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="877" y="1766.3169">14</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="140" x="899" y="1766.3169">Consume message</text><path d="M39,1786.3828 L109,1786.3828 L109,1793.3828 L99,1803.3828 L39,1803.3828 L39,1786.3828 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="131.6641" style="stroke: #000000; stroke-width: 2.0;" width="2552.5" x="39" y="1786.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="54" y="1799.4497">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="119" x="124" y="1798.5933">[action == 'reject']</text><rect fill="#FFFFFF" filter="url(#f113h6la0zwzd6)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="2534.5" x="46" y="1828.5156"/><polygon fill="#EEEEEE" points="46,1828.5156,112,1828.5156,112,1835.5156,102,1845.5156,46,1845.5156,46,1828.5156" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="59" y="1842.5825">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="1156.25" y="1861.5825">Send notification to Participant (Payer) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="48" x="1414.25" y="1861.5825">1.1.4.a.</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1414.25" x2="1462.25" y1="1863.5825" y2="1863.5825"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1462.25" y="1861.5825">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1160.25" y="1876.7153"/><polygon fill="#A80036" points="86,1906.0469,76,1910.0469,86,1914.0469,82,1910.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="80" x2="859" y1="1910.0469" y2="1910.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="92" y="1904.981">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="114" y="1904.981">Send callback notification</text><!--
@startuml
title 2.2.0. DFSP2 sends a Fulfil Reject Transfer request

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Fulfil-Topic" as TOPIC_FULFIL
control "Fulfil Event Handler" as FULF_HANDLER
collections "topic-transfer-position" as TOPIC_TRANSFER_POSITION
control "Position Event Handler" as POS_HANDLER
collections "Transfer-Topic" as TOPIC_TRANSFERS
collections "Event-Topic" as TOPIC_EVENTS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_FULFIL
    participant FULF_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant TOPIC_EVENTS
    participant POS_HANDLER
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate FULF_HANDLER
activate POS_HANDLER
activate TRANS_HANDLER
group DFSP2 sends a Fulfil Reject Transfer request
    DFSP2 <-> DFSP2: Retrieve fulfilment string generated during\nthe quoting process or regenerate it using\n**Local secret** and **ILP Packet** as inputs
    note right of DFSP2 #yellow
        Headers - transferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - transferMessage:
        {
            "fulfilment": <IlpFulfilment>,
            "completedTimestamp": <DateTime>,
            "transferState": <color #FF0000>"ABORTED"</color>,
            <color #FF0000>"extensionList":</color> {
                "extension": [
                    {
                        "key": <string>,
                        "value": <string>
                    }
                ]
            }
        }
    end note
    note right of DFSP2 #lightgray
        **Note**: Payee rejection reason should be captured
        in the extensionList within the payload.
    end note
    DFSP2 -> MLAPI: <color #FF0000>PUT - /transfers/<ID></color>
    
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming token and originator matching Payee
    note right of MLAPI #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: fulfil,
                    action: reject,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_FULFIL: <color #FF0000>**Route & Publish Fulfil event for Payee**</color>
    activate TOPIC_FULFIL
    TOPIC_FULFIL <-> TOPIC_FULFIL: Ensure event is replicated as configured (ACKS=all)
    TOPIC_FULFIL - -> MLAPI: Respond replication acknowledgements have been received
    deactivate TOPIC_FULFIL
    MLAPI - -> DFSP2: Respond HTTP - 200 (OK)
    deactivate MLAPI
    TOPIC_FULFIL <- FULF_HANDLER: Consume message
    ref over TOPIC_FULFIL, TOPIC_EVENTS: Fulfil Handler Consume (Reject) {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-reject-2.2.1.svg 2.2.1.]]} \n
    FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Produce message
    |||
    TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume message
    ref over TOPIC_TRANSFER_POSITION, TOPIC_TRANSFERS: Position Handler Consume (Reject) {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-position-1.3.3-abort.svg seq-position-1.3.3-abort]]} \n
    POS_HANDLER -> TOPIC_TRANSFERS: Produce message
    |||
    TOPIC_TRANSFERS <- TRANS_HANDLER: Consume message
    ref over TOPIC_EVENTS, TOPIC_NOTIFICATIONS: Transfer Handler Consume (Reject) {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-reject-2.2.3.svg 2.2.3.]]} \n
    TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: <color #FF0000>**Consume message**</color>
    opt action == 'reject'
        |||
        ref over DFSP1, TOPIC_NOTIFICATIONS: Send notification to Participant (Payer) {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg 1.1.4.a.]]} \n
        NOTIFY_HANDLER -> DFSP1: Send callback notification
    end
    |||
end
activate TRANS_HANDLER
activate POS_HANDLER
activate FULF_HANDLER
activate NOTIFY_HANDLER
@enduml

PlantUML version 1.2018.12(Sun Oct 21 05:15:15 CDT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_191-8u191-b12-0ubuntu0.16.04.1-b12
Operating System: Linux
OS Version: 4.4.0-31-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>