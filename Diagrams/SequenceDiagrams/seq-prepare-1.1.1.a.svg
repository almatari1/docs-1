<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="4718px" preserveAspectRatio="none" style="width:1934px;height:4718px;" version="1.1" viewBox="0 0 1934 4718" width="1934px" zoomAndPan="magnify"><defs><filter height="300%" id="f1bpwy7fs1q72c" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="412" x="762" y="22.9951">1.1.1.a. Prepare Handler Consume (single message)</text><rect fill="#FFFFE0" height="4672.7891" style="stroke: #A80036; stroke-width: 1.0;" width="1818" x="19" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="872.5" y="46.3638">Central Service</text><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="104.5" y="170.9922"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="4506.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="364.5" y="125.7266"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="924.5" y="4012.7344"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1225.5" y="4579.7891"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1355" y="722.25"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="135.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1355" y="1148.1094"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1355" y="1361.1719"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="91.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1355" y="2290.2344"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="181.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1355" y="3051.8203"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="197.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1355" y="3339.0859"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="135.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1470.5" y="2448.8984"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="135.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1470.5" y="2702.0938"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1780" y="751.3828"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="77.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1780" y="1177.2422"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1780" y="1390.3047"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="77.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1780" y="2478.0313"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="77.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1780" y="2731.2266"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1780" y="3080.9531"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1780" y="3368.2188"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="4492.0625" style="stroke: #000000; stroke-width: 2.0;" width="1910" x="13" y="132.7266"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="105.5313" style="stroke: #000000; stroke-width: 2.0;" width="556" x="269.5" y="215.9922"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="74.3984" style="stroke: #000000; stroke-width: 2.0;" width="536" x="279.5" y="240.125"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="156.6641" style="stroke: #000000; stroke-width: 2.0;" width="861" x="279.5" y="335.5234"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="3051.9609" style="stroke: #000000; stroke-width: 2.0;" width="1683.5" x="229.5" y="506.1875"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="1712.6484" style="stroke: #000000; stroke-width: 2.0;" width="1663.5" x="239.5" y="683.9844"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="1531.8516" style="stroke: #000000; stroke-width: 2.0;" width="1643.5" x="249.5" y="857.7813"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="156.6641" style="stroke: #000000; stroke-width: 2.0;" width="861" x="279.5" y="881.9141"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="1137.4531" style="stroke: #000000; stroke-width: 2.0;" width="1623.5" x="259.5" y="1094.7109"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="821.0547" style="stroke: #000000; stroke-width: 2.0;" width="1603.5" x="269.5" y="1298.7734"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="789.9219" style="stroke: #000000; stroke-width: 2.0;" width="1583.5" x="279.5" y="1322.9063"/><rect fill="#FFFFFF" height="56.9375" style="stroke: none; stroke-width: 1.0;" width="1583.5" x="279.5" y="1981.6875"/><rect fill="#FFFFFF" height="74.2031" style="stroke: none; stroke-width: 1.0;" width="1583.5" x="279.5" y="2038.625"/><rect fill="#FFFFFF" height="105.3359" style="stroke: none; stroke-width: 1.0;" width="1623.5" x="259.5" y="2126.8281"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="76.5313" style="stroke: #000000; stroke-width: 2.0;" width="1031.5" x="279.5" y="2148.6328"/><rect fill="#FFFFFF" height="150.4688" style="stroke: none; stroke-width: 1.0;" width="1643.5" x="249.5" y="2239.1641"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="239.1953" style="stroke: #000000; stroke-width: 2.0;" width="1589.5" x="279.5" y="2410.6328"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="239.1953" style="stroke: #000000; stroke-width: 2.0;" width="1589.5" x="279.5" y="2663.8281"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="576.8594" style="stroke: #000000; stroke-width: 2.0;" width="1614.5" x="269.5" y="2974.2891"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="243.3281" style="stroke: #000000; stroke-width: 2.0;" width="1594.5" x="279.5" y="2998.4219"/><rect fill="#FFFFFF" height="302.3984" style="stroke: none; stroke-width: 1.0;" width="1614.5" x="269.5" y="3248.75"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="273.5938" style="stroke: #000000; stroke-width: 2.0;" width="1594.5" x="279.5" y="3270.5547"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="1045.6406" style="stroke: #000000; stroke-width: 2.0;" width="1031.5" x="279.5" y="3572.1484"/><rect fill="#FFFFFF" height="567.0547" style="stroke: none; stroke-width: 1.0;" width="1031.5" x="279.5" y="4050.7344"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="109" x2="109" y1="115.7266" y2="4641.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="369.5" x2="369.5" y1="115.7266" y2="4641.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="929.5" x2="929.5" y1="115.7266" y2="4641.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1078.5" x2="1078.5" y1="115.7266" y2="4641.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1230" x2="1230" y1="115.7266" y2="4641.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1360" x2="1360" y1="115.7266" y2="4641.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1475" x2="1475" y1="115.7266" y2="4641.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1785" x2="1785" y1="115.7266" y2="4641.7891"/><rect fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="165" x="27" y="76.4297"/><rect fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="165" x="23" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="30" y="100.4248">topic-transfer-prepare</text><rect fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="165" x="27" y="4640.7891"/><rect fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="165" x="23" y="4644.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="30" y="4664.7842">topic-transfer-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="289.5" y="112.4248">Prepare Event Handler</text><ellipse cx="369.5" cy="83.4297" fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="365.5,71.4297,371.5,66.4297,369.5,71.4297,371.5,76.4297,365.5,71.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="289.5" y="4653.7842">Prepare Event Handler</text><ellipse cx="369.5" cy="4673.0859" fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="365.5,4661.0859,371.5,4656.0859,369.5,4661.0859,371.5,4666.0859,365.5,4661.0859" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="846.5" y="76.4297"/><rect fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="842.5" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="849.5" y="100.4248">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="846.5" y="4640.7891"/><rect fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="842.5" y="4644.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="849.5" y="4664.7842">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1030.5" y="76.4297"/><rect fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1026.5" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1033.5" y="100.4248">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1030.5" y="4640.7891"/><rect fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1026.5" y="4644.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1033.5" y="4664.7842">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="1164" y="76.4297"/><rect fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="1160" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="1167" y="100.4248">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="1164" y="4640.7891"/><rect fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="1160" y="4644.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="1167" y="4664.7842">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="1311" y="112.4248">Transfer DAO</text><ellipse cx="1360" cy="83.4297" fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1348" x2="1372" y1="97.4297" y2="97.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="1311" y="4653.7842">Transfer DAO</text><ellipse cx="1360" cy="4673.0859" fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1348" x2="1372" y1="4687.0859" y2="4687.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="1419" y="112.4248">Participant DAO</text><ellipse cx="1475.5" cy="83.4297" fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1463.5" x2="1487.5" y1="97.4297" y2="97.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="1419" y="4653.7842">Participant DAO</text><ellipse cx="1475.5" cy="4673.0859" fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1463.5" x2="1487.5" y1="4687.0859" y2="4687.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1737" y="112.4248">Central Store</text><path d="M1767,63.4297 C1767,53.4297 1785,53.4297 1785,53.4297 C1785,53.4297 1803,53.4297 1803,63.4297 L1803,89.4297 C1803,99.4297 1785,99.4297 1785,99.4297 C1785,99.4297 1767,99.4297 1767,89.4297 L1767,63.4297 " fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1767,63.4297 C1767,73.4297 1785,73.4297 1785,73.4297 C1785,73.4297 1803,73.4297 1803,63.4297 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1737" y="4653.7842">Central Store</text><path d="M1767,4667.0859 C1767,4657.0859 1785,4657.0859 1785,4657.0859 C1785,4657.0859 1803,4657.0859 1803,4667.0859 L1803,4693.0859 C1803,4703.0859 1785,4703.0859 1785,4703.0859 C1785,4703.0859 1767,4703.0859 1767,4693.0859 L1767,4667.0859 " fill="#FEFECE" filter="url(#f1bpwy7fs1q72c)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1767,4667.0859 C1767,4677.0859 1785,4677.0859 1785,4677.0859 C1785,4677.0859 1803,4677.0859 1803,4667.0859 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="104.5" y="170.9922"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="4506.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="364.5" y="125.7266"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="924.5" y="4012.7344"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1225.5" y="4579.7891"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1355" y="722.25"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="135.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1355" y="1148.1094"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1355" y="1361.1719"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="91.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1355" y="2290.2344"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="181.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1355" y="3051.8203"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="197.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1355" y="3339.0859"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="135.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1470.5" y="2448.8984"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="135.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1470.5" y="2702.0938"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1780" y="751.3828"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="77.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1780" y="1177.2422"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1780" y="1390.3047"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="77.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1780" y="2478.0313"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="77.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1780" y="2731.2266"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1780" y="3080.9531"/><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1780" y="3368.2188"/><path d="M13,132.7266 L253,132.7266 L253,139.7266 L243,149.7266 L13,149.7266 L13,132.7266 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="4492.0625" style="stroke: #000000; stroke-width: 2.0;" width="1910" x="13" y="132.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="195" x="28" y="145.7935">Prepare Handler Consume</text><polygon fill="#A80036" points="125.5,166.9922,115.5,170.9922,125.5,174.9922,121.5,170.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="119.5" x2="363.5" y1="170.9922" y2="170.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="131.5" y="165.9263">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="144.5" y="165.9263">Consume Prepare event message</text><path d="M269.5,215.9922 L357.5,215.9922 L357.5,222.9922 L347.5,232.9922 L269.5,232.9922 L269.5,215.9922 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="105.5313" style="stroke: #000000; stroke-width: 2.0;" width="556" x="269.5" y="215.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="284.5" y="229.0591">break</text><path d="M279.5,240.125 L431.5,240.125 L431.5,247.125 L421.5,257.125 L279.5,257.125 L279.5,240.125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.3984" style="stroke: #000000; stroke-width: 2.0;" width="536" x="279.5" y="240.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="107" x="294.5" y="253.1919">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="416.5" y1="293.5234" y2="293.5234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="416.5" x2="416.5" y1="293.5234" y2="306.5234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="375.5" x2="416.5" y1="306.5234" y2="306.5234"/><polygon fill="#A80036" points="385.5,302.5234,375.5,306.5234,385.5,310.5234,381.5,306.5234" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="381.5" y="280.8911">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="409" x="394.5" y="273.3247">Validate event - Rule: type == 'prepare' &amp;&amp; action == 'prepare'</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="394.5" y="288.4575">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488.5" y="288.4575">2001</text><path d="M279.5,335.5234 L511.5,335.5234 L511.5,342.5234 L501.5,352.5234 L279.5,352.5234 L279.5,335.5234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="156.6641" style="stroke: #000000; stroke-width: 2.0;" width="861" x="279.5" y="335.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="294.5" y="348.5903">Persist Event Information</text><polygon fill="#A80036" points="1066.5,394.7891,1076.5,398.7891,1066.5,402.7891,1070.5,398.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="1072.5" y1="398.7891" y2="398.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="381.5" y="393.7231">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="394.5" y="393.7231">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="843" x="286.5" y="406.7891"/><polygon fill="#EEEEEE" points="286.5,406.7891,352.5,406.7891,352.5,413.7891,342.5,423.7891,286.5,423.7891,286.5,406.7891" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="299.5" y="420.856">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="604.5" y="439.856">Event Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="32" x="771.5" y="439.856">9.1.0</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="771.5" x2="803.5" y1="441.856" y2="441.856"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="803.5" y="439.856">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="608.5" y="454.9888"/><path d="M229.5,506.1875 L465.5,506.1875 L465.5,513.1875 L455.5,523.1875 L229.5,523.1875 L229.5,506.1875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3051.9609" style="stroke: #000000; stroke-width: 2.0;" width="1683.5" x="229.5" y="506.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="191" x="244.5" y="519.2544">Validate Prepare Transfer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="416.5" y1="544.4531" y2="544.4531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="416.5" x2="416.5" y1="544.4531" y2="557.4531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="375.5" x2="416.5" y1="557.4531" y2="557.4531"/><polygon fill="#A80036" points="385.5,553.4531,375.5,557.4531,385.5,561.4531,381.5,557.4531" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="381.5" y="539.3872">4</text><text fill="#AAAAAA" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="284" x="394.5" y="539.3872">Schema validation of the incoming message</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="416.5" y1="586.5859" y2="586.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="416.5" x2="416.5" y1="586.5859" y2="599.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="375.5" x2="416.5" y1="599.5859" y2="599.5859"/><polygon fill="#A80036" points="385.5,595.5859,375.5,599.5859,385.5,603.5859,381.5,599.5859" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="381.5" y="581.52">5</text><text fill="#AAAAAA" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="453" x="394.5" y="581.52">Verify the message's signature (to be confirmed in future requirement)</text><path d="M379,612.5859 L379,667.5859 L752,667.5859 L752,622.5859 L742,612.5859 L379,612.5859 " fill="#D3D3D3" filter="url(#f1bpwy7fs1q72c)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M742,612.5859 L742,622.5859 L752,622.5859 L742,612.5859 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="385" y="629.6528">The above validation steps are already handled by</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="337" x="385" y="644.7856">the ML-Adapter for the open source implementation.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="352" x="385" y="659.9185">It may need to be added in future for custom adapters.</text><path d="M239.5,683.9844 L468.5,683.9844 L468.5,690.9844 L458.5,700.9844 L239.5,700.9844 L239.5,683.9844 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1712.6484" style="stroke: #000000; stroke-width: 2.0;" width="1663.5" x="239.5" y="683.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="184" x="254.5" y="697.0513">Validate Duplicate check</text><polygon fill="#A80036" points="1343,718.25,1353,722.25,1343,726.25,1347,722.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="1349" y1="722.25" y2="722.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="381.5" y="717.1841">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="394.5" y="717.1841">Request to retrieve Transfer Hash for a transferId</text><polygon fill="#A80036" points="1768,747.3828,1778,751.3828,1768,755.3828,1772,751.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1365" x2="1774" y1="751.3828" y2="751.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1372" y="746.3169">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="1385" y="746.3169">Request Transfer Hash for a transferId</text><polygon fill="#FFFFE0" filter="url(#f1bpwy7fs1q72c)" points="1708,764.3828,1861,764.3828,1871,775.3828,1861,787.3828,1708,787.3828,1698,775.3828,1708,764.3828" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="1710" y="780.4497">transferDuplicateCheck</text><polygon fill="#A80036" points="1376,809.6484,1366,813.6484,1376,817.6484,1372,813.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1370" x2="1784" y1="813.6484" y2="813.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1382" y="808.5825">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="1395" y="808.5825">Return hash if it exists</text><polygon fill="#A80036" points="385.5,838.7813,375.5,842.7813,385.5,846.7813,381.5,842.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="379.5" x2="1359" y1="842.7813" y2="842.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="391.5" y="837.7153">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="404.5" y="837.7153">Return hash if it exists</text><path d="M249.5,857.7813 L313.5,857.7813 L313.5,864.7813 L303.5,874.7813 L249.5,874.7813 L249.5,857.7813 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1531.8516" style="stroke: #000000; stroke-width: 2.0;" width="1643.5" x="249.5" y="857.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="264.5" y="870.8481">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="328.5" y="869.9917">[If transferId exists]</text><path d="M279.5,881.9141 L511.5,881.9141 L511.5,888.9141 L501.5,898.9141 L279.5,898.9141 L279.5,881.9141 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="156.6641" style="stroke: #000000; stroke-width: 2.0;" width="861" x="279.5" y="881.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="294.5" y="894.981">Persist Event Information</text><polygon fill="#A80036" points="1066.5,941.1797,1076.5,945.1797,1066.5,949.1797,1070.5,945.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="1072.5" y1="945.1797" y2="945.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="940.1138">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="403.5" y="940.1138">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1bpwy7fs1q72c)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="843" x="286.5" y="953.1797"/><polygon fill="#EEEEEE" points="286.5,953.1797,352.5,953.1797,352.5,960.1797,342.5,970.1797,286.5,970.1797,286.5,953.1797" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="299.5" y="967.2466">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="604.5" y="986.2466">Event Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="32" x="771.5" y="986.2466">9.1.0</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="771.5" x2="803.5" y1="988.2466" y2="988.2466"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="803.5" y="986.2466">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="608.5" y="1001.3794"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="416.5" y1="1066.7109" y2="1066.7109"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="416.5" x2="416.5" y1="1066.7109" y2="1079.7109"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="375.5" x2="416.5" y1="1079.7109" y2="1079.7109"/><polygon fill="#A80036" points="385.5,1075.7109,375.5,1079.7109,385.5,1083.7109,381.5,1079.7109" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="1061.645">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="407" x="403.5" y="1061.645">Generate Hash for the incoming message and compare hashes</text><path d="M259.5,1094.7109 L323.5,1094.7109 L323.5,1101.7109 L313.5,1111.7109 L259.5,1111.7109 L259.5,1094.7109 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1137.4531" style="stroke: #000000; stroke-width: 2.0;" width="1623.5" x="259.5" y="1094.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="274.5" y="1107.7778">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="338.5" y="1106.9214">[Transfer exists, hash matches]</text><polygon fill="#A80036" points="1343,1144.1094,1353,1148.1094,1343,1152.1094,1347,1148.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="1349" y1="1148.1094" y2="1148.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="1135.4771">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="403.5" y="1127.9106">Request to retrieve Transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="403.5" y="1143.0435">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="489.5" y="1143.0435">2003</text><polygon fill="#A80036" points="1768,1173.2422,1778,1177.2422,1768,1181.2422,1772,1177.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1365" x2="1774" y1="1177.2422" y2="1177.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1372" y="1172.1763">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="1394" y="1172.1763">Request Transfer state</text><polygon fill="#FFFFE0" filter="url(#f1bpwy7fs1q72c)" points="1716,1190.2422,1854,1190.2422,1864,1209.2422,1854,1228.2422,1716,1228.2422,1706,1209.2422,1716,1190.2422" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="1718" y="1206.3091">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="1718" y="1221.4419">transferStateChange</text><polygon fill="#A80036" points="1376,1250.6406,1366,1254.6406,1376,1258.6406,1372,1254.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1370" x2="1784" y1="1254.6406" y2="1254.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1382" y="1249.5747">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="1404" y="1249.5747">Return Transfer state</text><polygon fill="#A80036" points="385.5,1279.7734,375.5,1283.7734,385.5,1287.7734,381.5,1283.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="379.5" x2="1359" y1="1283.7734" y2="1283.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="391.5" y="1278.7075">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="413.5" y="1278.7075">Return Transfer state</text><path d="M269.5,1298.7734 L357.5,1298.7734 L357.5,1305.7734 L347.5,1315.7734 L269.5,1315.7734 L269.5,1298.7734 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="821.0547" style="stroke: #000000; stroke-width: 2.0;" width="1603.5" x="269.5" y="1298.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="284.5" y="1311.8403">break</text><path d="M279.5,1322.9063 L343.5,1322.9063 L343.5,1329.9063 L333.5,1339.9063 L279.5,1339.9063 L279.5,1322.9063 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="789.9219" style="stroke: #000000; stroke-width: 2.0;" width="1583.5" x="279.5" y="1322.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="294.5" y="1335.9731">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="297" x="358.5" y="1335.1167">[If transferState IN ['COMMITTED', 'ABORTED']]</text><polygon fill="#A80036" points="1343,1357.1719,1353,1361.1719,1343,1365.1719,1347,1361.1719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="1349" y1="1361.1719" y2="1361.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="1356.106">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="444" x="403.5" y="1356.106">Request to retrieve fulfilment, completedTimestamp for the transferId</text><polygon fill="#A80036" points="1768,1386.3047,1778,1390.3047,1768,1394.3047,1772,1390.3047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1365" x2="1774" y1="1390.3047" y2="1390.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1372" y="1385.2388">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="374" x="1394" y="1385.2388">Request fulfilment, completedTimestamp for the transferId</text><polygon fill="#FFFFE0" filter="url(#f1bpwy7fs1q72c)" points="1727,1403.3047,1843,1403.3047,1853,1414.3047,1843,1426.3047,1727,1426.3047,1717,1414.3047,1727,1403.3047" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="1729" y="1419.3716">transferFulfilment</text><polygon fill="#A80036" points="1376,1448.5703,1366,1452.5703,1376,1456.5703,1372,1452.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1370" x2="1784" y1="1452.5703" y2="1452.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1382" y="1447.5044">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="340" x="1404" y="1447.5044">Return fulfilment, completedTimestamp (if they exist)</text><polygon fill="#A80036" points="385.5,1477.7031,375.5,1481.7031,385.5,1485.7031,381.5,1481.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="379.5" x2="1359" y1="1481.7031" y2="1481.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="391.5" y="1476.6372">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="340" x="413.5" y="1476.6372">Return fulfilment, completedTimestamp (if they exist)</text><path d="M379,1494.7031 L379,1927.7031 L865,1927.7031 L865,1504.7031 L855,1494.7031 L379,1494.7031 " fill="#FFFF00" filter="url(#f1bpwy7fs1q72c)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M855,1494.7031 L855,1504.7031 L865,1504.7031 L855,1494.7031 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="385" y="1511.77">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="385" y="1526.9028">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="401" y="1542.0356">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="401" y="1557.1685">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="401" y="1572.3013">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="401" y="1587.4341">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="401" y="1602.5669">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="417" y="1617.6997">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="417" y="1632.8325">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="433" y="1647.9653">transferState: "COMMITTED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="417" x="433" y="1663.0981">fulfilment: "WLctttbu2HvTsa1XWvUoGRcQozHsqeu9Ahl2JW9Bsu8",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="364" x="433" y="1678.231">completedTimestamp: "2018-10-24T08:38:08.699-04:00"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="417" y="1693.3638">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="401" y="1708.4966">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="401" y="1723.6294">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="417" y="1738.7622">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="433" y="1753.895">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="433" y="1769.0278">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="433" y="1784.1606">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="433" y="1799.2935">action: prepare-duplicate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="433" y="1814.4263">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="433" y="1829.5591">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="449" y="1844.6919">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="449" y="1859.8247">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="433" y="1874.9575">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="417" y="1890.0903">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="401" y="1905.2231">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="385" y="1920.356">}</text><polygon fill="#A80036" points="1218.5,1969.6875,1228.5,1973.6875,1218.5,1977.6875,1222.5,1973.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="1224.5" y1="1973.6875" y2="1973.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="1961.0552">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="402" x="403.5" y="1953.4888">Publish Notification event for Payer with the completed transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="810" x="403.5" y="1968.6216">For the Data Model, refer to the Swagger (transferState - mandatory, fulfilment, completedTimestamp - sample values above).</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279.5" x2="1863" y1="1982.6875" y2="1982.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="286" x="284.5" y="1992.8979">[If transferState IN ['RECEIVED', 'RESERVED']]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="416.5" y1="2017.625" y2="2017.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="416.5" x2="416.5" y1="2017.625" y2="2030.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="375.5" x2="416.5" y1="2030.625" y2="2030.625"/><polygon fill="#A80036" points="385.5,2026.625,375.5,2030.625,385.5,2034.625,381.5,2030.625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="2012.5591">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="514" x="403.5" y="2012.5591">This request can be ignored, because a callback is about to be sent to the client.</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279.5" x2="1863" y1="2039.625" y2="2039.625"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="284.5" y="2049.8354">[If transferState does not exist]</text><polygon fill="#A80036" points="1218.5,2100.8281,1228.5,2104.8281,1218.5,2108.8281,1222.5,2104.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="1224.5" y1="2104.8281" y2="2104.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="2084.6294">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="332" x="403.5" y="2069.4966">Send /error callback with appropriate error message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="403.5" y="2084.6294">(Invalid duplicate request)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="403.5" y="2099.7622">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="489.5" y="2099.7622">3100</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="259.5" x2="1883" y1="2127.8281" y2="2127.8281"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="248" x="264.5" y="2138.0386">[Transfer exists, hash does not match]</text><path d="M279.5,2148.6328 L367.5,2148.6328 L367.5,2155.6328 L357.5,2165.6328 L279.5,2165.6328 L279.5,2148.6328 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="76.5313" style="stroke: #000000; stroke-width: 2.0;" width="1031.5" x="279.5" y="2148.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="294.5" y="2161.6997">break</text><polygon fill="#A80036" points="1218.5,2213.1641,1228.5,2217.1641,1218.5,2221.1641,1222.5,2217.1641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="1224.5" y1="2217.1641" y2="2217.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="2196.9653">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="403.5" y="2181.8325">Publish Notification (failure) event for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="403.5" y="2196.9653">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="497.5" y="2196.9653">3106</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="533.5" y="2196.9653"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="498" x="403.5" y="2212.0981">For the Data Model, refer to the final step in this diagram (has the same text).</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="249.5" x2="1893" y1="2240.1641" y2="2240.1641"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="254.5" y="2250.3745">[If transferId does NOT exist]</text><polygon fill="#A80036" points="1343,2286.2344,1353,2290.2344,1343,2294.2344,1347,2290.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="1349" y1="2290.2344" y2="2290.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="2277.6021">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="403.5" y="2270.0356">Request to persist Transfer Hash</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="403.5" y="2285.1685">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="489.5" y="2285.1685">2003</text><polygon fill="#A80036" points="1773,2315.3672,1783,2319.3672,1773,2323.3672,1777,2319.3672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1365" x2="1779" y1="2319.3672" y2="2319.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1372" y="2314.3013">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="1394" y="2314.3013">Persist Transfer message hash</text><polygon fill="#FFFFE0" filter="url(#f1bpwy7fs1q72c)" points="1708,2332.3672,1861,2332.3672,1871,2343.3672,1861,2355.3672,1708,2355.3672,1698,2343.3672,1708,2332.3672" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="1710" y="2348.4341">transferDuplicateCheck</text><polygon fill="#A80036" points="385.5,2377.6328,375.5,2381.6328,385.5,2385.6328,381.5,2381.6328" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="379.5" x2="1359" y1="2381.6328" y2="2381.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="391.5" y="2376.5669">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="413.5" y="2376.5669">Return success</text><path d="M279.5,2410.6328 L432.5,2410.6328 L432.5,2417.6328 L422.5,2427.6328 L279.5,2427.6328 L279.5,2410.6328 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="239.1953" style="stroke: #000000; stroke-width: 2.0;" width="1589.5" x="279.5" y="2410.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="294.5" y="2423.6997">Validate Payer</text><polygon fill="#A80036" points="1458.5,2444.8984,1468.5,2448.8984,1458.5,2452.8984,1462.5,2448.8984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="1464.5" y1="2448.8984" y2="2448.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="2443.8325">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="354" x="403.5" y="2443.8325">Request to retrieve Payer Participant details (if it exists)</text><polygon fill="#A80036" points="1768,2474.0313,1778,2478.0313,1768,2482.0313,1772,2478.0313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1480.5" x2="1774" y1="2478.0313" y2="2478.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1487.5" y="2472.9653">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="1509.5" y="2472.9653">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#f1bpwy7fs1q72c)" points="1720,2491.0313,1849,2491.0313,1859,2510.0313,1849,2529.0313,1720,2529.0313,1710,2510.0313,1720,2491.0313" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1722" y="2507.0981">participant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="1722" y="2522.231">participantCurrency</text><polygon fill="#A80036" points="1491.5,2551.4297,1481.5,2555.4297,1491.5,2559.4297,1487.5,2555.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1485.5" x2="1784" y1="2555.4297" y2="2555.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1497.5" y="2550.3638">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="1519.5" y="2550.3638">Return Participant details if it exists</text><polygon fill="#A80036" points="385.5,2580.5625,375.5,2584.5625,385.5,2588.5625,381.5,2584.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="379.5" x2="1474.5" y1="2584.5625" y2="2584.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="391.5" y="2579.4966">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="413.5" y="2579.4966">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="416.5" y1="2628.8281" y2="2628.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="416.5" x2="416.5" y1="2628.8281" y2="2641.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="375.5" x2="416.5" y1="2641.8281" y2="2641.8281"/><polygon fill="#A80036" points="385.5,2637.8281,375.5,2641.8281,385.5,2645.8281,381.5,2641.8281" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="2616.1958">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="403.5" y="2608.6294">Validate Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="403.5" y="2623.7622">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="497.5" y="2623.7622">3202</text><path d="M279.5,2663.8281 L435.5,2663.8281 L435.5,2670.8281 L425.5,2680.8281 L279.5,2680.8281 L279.5,2663.8281 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="239.1953" style="stroke: #000000; stroke-width: 2.0;" width="1589.5" x="279.5" y="2663.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="294.5" y="2676.895">Validate Payee</text><polygon fill="#A80036" points="1458.5,2698.0938,1468.5,2702.0938,1458.5,2706.0938,1462.5,2702.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="1464.5" y1="2702.0938" y2="2702.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="2697.0278">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="403.5" y="2697.0278">Request to retrieve Payee Participant details (if it exists)</text><polygon fill="#A80036" points="1768,2727.2266,1778,2731.2266,1768,2735.2266,1772,2731.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1480.5" x2="1774" y1="2731.2266" y2="2731.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1487.5" y="2726.1606">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="1509.5" y="2726.1606">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#f1bpwy7fs1q72c)" points="1720,2744.2266,1849,2744.2266,1859,2763.2266,1849,2782.2266,1720,2782.2266,1710,2763.2266,1720,2744.2266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1722" y="2760.2935">participant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="1722" y="2775.4263">participantCurrency</text><polygon fill="#A80036" points="1491.5,2804.625,1481.5,2808.625,1491.5,2812.625,1487.5,2808.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1485.5" x2="1784" y1="2808.625" y2="2808.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1497.5" y="2803.5591">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="1519.5" y="2803.5591">Return Participant details if it exists</text><polygon fill="#A80036" points="385.5,2833.7578,375.5,2837.7578,385.5,2841.7578,381.5,2837.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="379.5" x2="1474.5" y1="2837.7578" y2="2837.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="391.5" y="2832.6919">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="413.5" y="2832.6919">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="416.5" y1="2882.0234" y2="2882.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="416.5" x2="416.5" y1="2882.0234" y2="2895.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="375.5" x2="416.5" y1="2895.0234" y2="2895.0234"/><polygon fill="#A80036" points="385.5,2891.0234,375.5,2895.0234,385.5,2899.0234,381.5,2895.0234" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="2869.3911">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="403.5" y="2861.8247">Validate Payee</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="403.5" y="2876.9575">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="497.5" y="2876.9575">3203</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="416.5" y1="2946.2891" y2="2946.2891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="416.5" x2="416.5" y1="2946.2891" y2="2959.2891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="375.5" x2="416.5" y1="2959.2891" y2="2959.2891"/><polygon fill="#A80036" points="385.5,2955.2891,375.5,2959.2891,385.5,2963.2891,381.5,2959.2891" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="2933.6567">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="403.5" y="2926.0903">Validate crypto-condition</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="403.5" y="2941.2231">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="497.5" y="2941.2231">3100</text><path d="M269.5,2974.2891 L333.5,2974.2891 L333.5,2981.2891 L323.5,2991.2891 L269.5,2991.2891 L269.5,2974.2891 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="576.8594" style="stroke: #000000; stroke-width: 2.0;" width="1614.5" x="269.5" y="2974.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="284.5" y="2987.356">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="240" x="348.5" y="2986.4995">[Validate Prepare Transfer (success)]</text><path d="M279.5,2998.4219 L800.5,2998.4219 L800.5,3005.4219 L790.5,3015.4219 L279.5,3015.4219 L279.5,2998.4219 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="243.3281" style="stroke: #000000; stroke-width: 2.0;" width="1594.5" x="279.5" y="2998.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="476" x="294.5" y="3011.4888">Persist Transfer State (with transferState='RECEIVED-PREPARE')</text><polygon fill="#A80036" points="1343,3047.8203,1353,3051.8203,1343,3055.8203,1347,3051.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="1349" y1="3051.8203" y2="3051.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="3039.188">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="403.5" y="3031.6216">Request to persist transfer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="403.5" y="3046.7544">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="497.5" y="3046.7544">2003</text><polygon fill="#A80036" points="1768,3076.9531,1778,3080.9531,1768,3084.9531,1772,3080.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1365" x2="1774" y1="3080.9531" y2="3080.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1372" y="3075.8872">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="1394" y="3075.8872">Persist transfer</text><polygon fill="#FFFFE0" filter="url(#f1bpwy7fs1q72c)" points="1716,3123.9531,1854,3123.9531,1864,3164.9531,1854,3206.9531,1716,3206.9531,1706,3164.9531,1716,3123.9531" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="1718" y="3140.02">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1718" y="3155.1528">transferParticipant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="1718" y="3170.2856">transferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="1718" y="3185.4185">transferExtension</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="1718" y="3200.5513">ilpPacket</text><polygon fill="#A80036" points="385.5,3229.75,375.5,3233.75,385.5,3237.75,381.5,3233.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="379.5" x2="1359" y1="3233.75" y2="3233.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="391.5" y="3228.6841">40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="413.5" y="3228.6841">Return success</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="269.5" x2="1884" y1="3249.75" y2="3249.75"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="231" x="274.5" y="3259.9604">[Validate Prepare Transfer (failure)]</text><path d="M279.5,3270.5547 L1142.5,3270.5547 L1142.5,3277.5547 L1132.5,3287.5547 L279.5,3287.5547 L279.5,3270.5547 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="273.5938" style="stroke: #000000; stroke-width: 2.0;" width="1594.5" x="279.5" y="3270.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="818" x="294.5" y="3283.6216">Persist Transfer State (with transferState='INVALID') (Introducing a new status INVALID to mark these entries)</text><polygon fill="#A80036" points="1343,3335.0859,1353,3339.0859,1343,3343.0859,1347,3339.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="1349" y1="3339.0859" y2="3339.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="3318.8872">41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="403.5" y="3303.7544">Request to persist transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="327" x="403.5" y="3318.8872">(when Payee/Payer/crypto-condition validation fails)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="403.5" y="3334.02">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="497.5" y="3334.02">2003</text><polygon fill="#A80036" points="1768,3364.2188,1778,3368.2188,1768,3372.2188,1772,3368.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1365" x2="1774" y1="3368.2188" y2="3368.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1372" y="3363.1528">42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="1394" y="3363.1528">Persist transfer</text><polygon fill="#FFFFE0" filter="url(#f1bpwy7fs1q72c)" points="1716,3411.2188,1854,3411.2188,1864,3460.2188,1854,3509.2188,1716,3509.2188,1706,3460.2188,1716,3411.2188" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="1718" y="3427.2856">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1718" y="3442.4185">transferParticipant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="1718" y="3457.5513">transferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="1718" y="3472.6841">transferExtension</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="1718" y="3487.8169">transferError</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="1718" y="3502.9497">ilpPacket</text><polygon fill="#A80036" points="385.5,3532.1484,375.5,3536.1484,385.5,3540.1484,381.5,3536.1484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="379.5" x2="1359" y1="3536.1484" y2="3536.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="391.5" y="3531.0825">43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="413.5" y="3531.0825">Return success</text><path d="M279.5,3572.1484 L343.5,3572.1484 L343.5,3579.1484 L333.5,3589.1484 L279.5,3589.1484 L279.5,3572.1484 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1045.6406" style="stroke: #000000; stroke-width: 2.0;" width="1031.5" x="279.5" y="3572.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="294.5" y="3585.2153">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="240" x="358.5" y="3584.3589">[Validate Prepare Transfer (success)]</text><path d="M379,3594.2813 L379,3967.2813 L649,3967.2813 L649,3604.2813 L639,3594.2813 L379,3594.2813 " fill="#FFFF00" filter="url(#f1bpwy7fs1q72c)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M639,3594.2813 L639,3604.2813 L649,3604.2813 L639,3594.2813 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="385" y="3611.3481">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="385" y="3626.481">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="401" y="3641.6138">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="401" y="3656.7466">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="401" y="3671.8794">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="401" y="3687.0122">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="401" y="3702.145">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="417" y="3717.2778">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="417" y="3732.4106">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="401" y="3747.5435">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="401" y="3762.6763">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="417" y="3777.8091">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="433" y="3792.9419">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="433" y="3808.0747">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="433" y="3823.2075">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="433" y="3838.3403">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="433" y="3853.4731">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="433" y="3868.606">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="449" y="3883.7388">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="449" y="3898.8716">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="433" y="3914.0044">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="417" y="3929.1372">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="401" y="3944.27">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="385" y="3959.4028">}</text><polygon fill="#A80036" points="912.5,4008.7344,922.5,4012.7344,912.5,4016.7344,916.5,4012.7344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="918.5" y1="4012.7344" y2="4012.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="4000.1021">44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="403.5" y="3992.5356">Route &amp; Publish Position event for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="403.5" y="4007.6685">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="497.5" y="4007.6685">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279.5" x2="1311" y1="4051.7344" y2="4051.7344"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="231" x="284.5" y="4061.9448">[Validate Prepare Transfer (failure)]</text><path d="M379,4070.5391 L379,4533.5391 L992,4533.5391 L992,4080.5391 L982,4070.5391 L379,4070.5391 " fill="#FFFF00" filter="url(#f1bpwy7fs1q72c)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M982,4070.5391 L982,4080.5391 L992,4080.5391 L982,4070.5391 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="385" y="4087.606">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="385" y="4102.7388">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="401" y="4117.8716">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="401" y="4133.0044">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="401" y="4148.1372">to: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="401" y="4163.27">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="401" y="4178.4028">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="417" y="4193.5356">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="417" y="4208.6685">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="433" y="4223.8013">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="528" x="449" y="4238.9341">"errorCode": &lt;possible codes: [2003, 3100, 3105, 3106, 3202, 3203, 3300, 3301]&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="393" x="449" y="4254.0669">"errorDescription": "&lt;refer to section 35.1.3 for description&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="319" x="449" y="4269.1997">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="417" y="4284.3325">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="401" y="4299.4653">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="401" y="4314.5981">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="417" y="4329.731">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="433" y="4344.8638">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="433" y="4359.9966">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="433" y="4375.1294">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="433" y="4390.2622">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="433" y="4405.395">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="433" y="4420.5278">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="449" y="4435.6606">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="449" y="4450.7935">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="449" y="4465.9263">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="433" y="4481.0591">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="417" y="4496.1919">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="401" y="4511.3247">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="385" y="4526.4575">}</text><polygon fill="#A80036" points="1213.5,4575.7891,1223.5,4579.7891,1213.5,4583.7891,1217.5,4579.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="374.5" x2="1219.5" y1="4579.7891" y2="4579.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="381.5" y="4567.1567">45</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="403.5" y="4559.5903">Publish Notification (failure) event for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="403.5" y="4574.7231">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="497.5" y="4574.7231">2003</text><!--
@startuml
title 1.1.1.a. Prepare Handler Consume (single message)

autonumber


collections "topic-transfer-prepare" as TOPIC_TRANSFER_PREPARE
control "Prepare Event Handler" as PREP_HANDLER
collections "topic-transfer-position" as TOPIC_TRANSFER_POSITION
collections "Event-Topic" as TOPIC_EVENTS
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Transfer DAO" as TRANS_DAO
entity "Participant DAO" as PARTICIPANT_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_TRANSFER_PREPARE
    participant PREP_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant TOPIC_EVENTS
    participant TOPIC_NOTIFICATIONS
    participant TRANS_DAO
    participant PARTICIPANT_DAO
    participant DB
end box

activate PREP_HANDLER
group Prepare Handler Consume
    TOPIC_TRANSFER_PREPARE <- PREP_HANDLER: Consume Prepare event message
    activate TOPIC_TRANSFER_PREPARE
    deactivate TOPIC_TRANSFER_PREPARE

    break
        group Validate Event
            PREP_HANDLER <-> PREP_HANDLER: Validate event - Rule: type == 'prepare' && action == 'prepare'\n<color #FF0000><b>Error codes:</b> 2001</color>
        end
    end

    group Persist Event Information
        |||
        PREP_HANDLER -> TOPIC_EVENTS: Publish event information
        ref over PREP_HANDLER, TOPIC_EVENTS :  Event Handler Consume {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-event-9.1.0.svg 9.1.0]]} \n
        |||
    end

    group Validate Prepare Transfer 
        PREP_HANDLER <-> PREP_HANDLER: <color #AAA>Schema validation of the incoming message</color>
        PREP_HANDLER <-> PREP_HANDLER: <color #AAA>Verify the message's signature (to be confirmed in future requirement)</color>
        note right of PREP_HANDLER #lightgrey
            The above validation steps are already handled by
            the ML-Adapter for the open source implementation.
            It may need to be added in future for custom adapters.
        end note
        group Validate Duplicate check
            PREP_HANDLER -> TRANS_DAO: Request to retrieve Transfer Hash for a transferId
            activate TRANS_DAO
            TRANS_DAO -> DB: Request Transfer Hash for a transferId
            activate DB
            hnote over DB #lightyellow
                transferDuplicateCheck
            end note
            TRANS_DAO <- - DB: Return hash if it exists
            deactivate DB
            PREP_HANDLER <- - TRANS_DAO: Return hash if it exists
            deactivate TRANS_DAO

            alt If transferId exists
                group Persist Event Information
                    |||
                    PREP_HANDLER -> TOPIC_EVENTS: Publish event information
                    ref over PREP_HANDLER, TOPIC_EVENTS :  Event Handler Consume {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-event-9.1.0.svg 9.1.0]]} \n
                    |||
                end
                PREP_HANDLER -> PREP_HANDLER: Generate Hash for the incoming message and compare hashes

                alt Transfer exists, hash matches    
                    PREP_HANDLER -> TRANS_DAO: Request to retrieve Transfer state \n<color #FF0000><b>Error code:</b> 2003</color>
                    activate TRANS_DAO
                    TRANS_DAO -> DB: Request Transfer state
                    hnote over DB #lightyellow
                        transfer
                        transferStateChange
                    end note
                    activate DB
                    TRANS_DAO <- - DB: Return Transfer state
                    deactivate DB
                    TRANS_DAO - -> PREP_HANDLER: Return Transfer state
                    deactivate TRANS_DAO
                    break
                        alt If transferState IN ['COMMITTED', 'ABORTED']
                            PREP_HANDLER -> TRANS_DAO: Request to retrieve fulfilment, completedTimestamp for the transferId
                            activate TRANS_DAO
                            TRANS_DAO -> DB: Request fulfilment, completedTimestamp for the transferId
                            activate DB
                            hnote over DB #lightyellow
                                transferFulfilment
                            end note
                            TRANS_DAO <- - DB: Return fulfilment, completedTimestamp (if they exist)
                            deactivate DB
                            PREP_HANDLER <- - TRANS_DAO: Return fulfilment, completedTimestamp (if they exist)
                            deactivate TRANS_DAO
                            note right of PREP_HANDLER #yellow
                            Message:
                            {
                                id: <transferMessage.transferId>
                                from: <transferMessage.payerFsp>,
                                to: <transferMessage.payeeFsp>,
                                type: application/json
                                content: {
                                    headers: <transferHeaders>,
                                    payload: {
                                        transferState: "COMMITTED",
                                        fulfilment: "WLctttbu2HvTsa1XWvUoGRcQozHsqeu9Ahl2JW9Bsu8",
                                        completedTimestamp: "2018-10-24T08:38:08.699-04:00"
                                    }
                                },
                                metadata: {
                                    event: {
                                        id: <uuid>,
                                        responseTo: <previous.uuid>,
                                        type: notification,
                                        action: prepare-duplicate,
                                        createdAt: <timestamp>,
                                        state: {
                                            status: "success",
                                            code: 0
                                        }
                                    }
                                }
                            }
                        end note
                            PREP_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification event for Payer with the completed transfer \nFor the Data Model, refer to the Swagger (transferState - mandatory, fulfilment, completedTimestamp - sample values above).
                        else If transferState IN ['RECEIVED', 'RESERVED']
                            PREP_HANDLER <-> PREP_HANDLER: This request can be ignored, because a callback is about to be sent to the client.
                        else If transferState does not exist
                            PREP_HANDLER -> TOPIC_NOTIFICATIONS: Send /error callback with appropriate error message\n(Invalid duplicate request)\n<color #FF0000><b>Error code:</b> 3100</color>
                        end
                    end
                else Transfer exists, hash does not match
                    break
                        PREP_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification (failure) event for Payer\n<color #FF0000><b>Error codes:</b> 3106</color> \nFor the Data Model, refer to the final step in this diagram (has the same text).
                    end
                end

            else If transferId does NOT exist
                PREP_HANDLER -> TRANS_DAO: Request to persist Transfer Hash \n<color #FF0000><b>Error code:</b> 2003</color>
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist Transfer message hash
                hnote over DB #lightyellow
                    transferDuplicateCheck
                end note
                TRANS_DAO - -> PREP_HANDLER: Return success
                deactivate TRANS_DAO
            end
            deactivate TRANS_DAO
            
        end

        group Validate Payer
            PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve Payer Participant details (if it exists)
            activate PARTICIPANT_DAO
            PARTICIPANT_DAO -> DB: Request Participant details
            hnote over DB #lightyellow
                participant
                participantCurrency
            end note
            activate DB
            PARTICIPANT_DAO <- - DB: Return Participant details if it exists
            deactivate DB
            PARTICIPANT_DAO - -> PREP_HANDLER: Return Participant details if it exists
            deactivate PARTICIPANT_DAO
            PREP_HANDLER <-> PREP_HANDLER: Validate Payer\n<color #FF0000><b>Error codes:</b> 3202</color>
        end
        group Validate Payee
            PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve Payee Participant details (if it exists)
            activate PARTICIPANT_DAO
            PARTICIPANT_DAO -> DB: Request Participant details
            hnote over DB #lightyellow
                participant
                participantCurrency
            end note
            activate DB
            PARTICIPANT_DAO <- - DB: Return Participant details if it exists
            deactivate DB
            PARTICIPANT_DAO - -> PREP_HANDLER: Return Participant details if it exists
            deactivate PARTICIPANT_DAO
            PREP_HANDLER <-> PREP_HANDLER: Validate Payee\n<color #FF0000><b>Error codes:</b> 3203</color>
        end
        PREP_HANDLER <-> PREP_HANDLER: Validate crypto-condition\n<color #FF0000><b>Error codes:</b> 3100</color>
        
        alt Validate Prepare Transfer (success)
            group Persist Transfer State (with transferState='RECEIVED-PREPARE')
                PREP_HANDLER -> TRANS_DAO: Request to persist transfer\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist transfer
                hnote over DB #lightyellow
                    transfer
                    transferParticipant
                    transferStateChange
                    transferExtension
                    ilpPacket
                end note
                activate DB
                deactivate DB
                TRANS_DAO - -> PREP_HANDLER: Return success
                deactivate TRANS_DAO
            end
        else Validate Prepare Transfer (failure)
            group Persist Transfer State (with transferState='INVALID') (Introducing a new status INVALID to mark these entries)
                PREP_HANDLER -> TRANS_DAO: Request to persist transfer\n(when Payee/Payer/crypto-condition validation fails)\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist transfer
                hnote over DB #lightyellow
                    transfer
                    transferParticipant
                    transferStateChange
                    transferExtension
                    transferError
                    ilpPacket
                end note
                activate DB
                deactivate DB
                TRANS_DAO - -> PREP_HANDLER: Return success
                deactivate TRANS_DAO
            end
        end

    end
    alt Validate Prepare Transfer (success)
        note right of PREP_HANDLER #yellow
            Message:
            {
                id: <transferMessage.transferId>
                from: <transferMessage.payerFsp>,
                to: <transferMessage.payeeFsp>,
                type: application/json
                content: {
                    headers: <transferHeaders>,
                    payload: <transferMessage>
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: position,
                        action: prepare,
                        createdAt: <timestamp>,
                        state: {
                            status: "success",
                            code: 0
                        }
                    }
                }
            }
        end note
        PREP_HANDLER -> TOPIC_TRANSFER_POSITION: Route & Publish Position event for Payer\n<color #FF0000><b>Error codes:</b> 2003</color>
        activate TOPIC_TRANSFER_POSITION
        deactivate TOPIC_TRANSFER_POSITION
    else Validate Prepare Transfer (failure)
        note right of PREP_HANDLER #yellow
            Message:
            {
                id: <transferMessage.transferId>
                from: <ledgerName>,
                to: <transferMessage.payerFsp>,
                type: application/json
                content: {
                    headers: <transferHeaders>,
                    payload: {
                        "errorInformation": {
                            "errorCode": <possible codes: [2003, 3100, 3105, 3106, 3202, 3203, 3300, 3301]>
                            "errorDescription": "<refer to section 35.1.3 for description>",
                            "extensionList": <transferMessage.extensionList>
                    }
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: notification,
                        action: prepare,
                        createdAt: <timestamp>,
                        state: {
                            status: 'error',
                            code: <errorInformation.errorCode>
                            description: <errorInformation.errorDescription>
                        }
                    }
                }
            }
        end note
        PREP_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification (failure) event for Payer\n<color #FF0000><b>Error codes:</b> 2003</color>
        activate TOPIC_NOTIFICATIONS
        deactivate TOPIC_NOTIFICATIONS
    end
end
deactivate PREP_HANDLER
@enduml

PlantUML version 1.2018.12(Sun Oct 21 05:15:15 CDT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_191-8u191-b12-0ubuntu0.16.04.1-b12
Operating System: Linux
OS Version: 4.4.0-31-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>