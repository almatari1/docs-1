<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2271px" preserveAspectRatio="none" style="width:2612px;height:2271px;" version="1.1" viewBox="0 0 2612 2271" width="2612px" zoomAndPan="magnify"><defs><filter height="300%" id="f1pdzg8uomms1h" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="420" x="1097.25" y="22.9951">2.1.0. DFSP2 sends a Fulfil Success Transfer request</text><rect fill="#D3D3D3" height="2226.2734" style="stroke: #A80036; stroke-width: 1.0;" width="204" x="4" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="198" x="7" y="46.3638">Financial Service Providers</text><rect fill="#ADD8E6" height="2226.2734" style="stroke: #A80036; stroke-width: 1.0;" width="568" x="416" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173" x="613.5" y="46.3638">ML API Adapter Service</text><rect fill="#FFFFE0" height="2226.2734" style="stroke: #A80036; stroke-width: 1.0;" width="1599.5" x="986" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="1730.25" y="46.3638">Central Service</text><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="589.1172" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="469" y="713.2734"/><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="1984.9531" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="860" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="86.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1176.5" y="1186.8594"/><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="1984.9531" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1542.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="1984.9531" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1999" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="1984.9531" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2340" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="1970.9531" style="stroke: #000000; stroke-width: 2.0;" width="2572.5" x="29" y="170.0234"/><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="131.6641" style="stroke: #000000; stroke-width: 2.0;" width="2552.5" x="39" y="1777.5156"/><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="131.6641" style="stroke: #000000; stroke-width: 2.0;" width="2490.5" x="101" y="1977.3125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="75" x2="75" y1="153.0234" y2="2157.9766"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="137" x2="137" y1="153.0234" y2="2157.9766"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="474" x2="474" y1="153.0234" y2="2157.9766"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="865" x2="865" y1="153.0234" y2="2157.9766"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1057" x2="1057" y1="153.0234" y2="2157.9766"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1181" x2="1181" y1="153.0234" y2="2157.9766"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1547.5" x2="1547.5" y1="153.0234" y2="2157.9766"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1712.5" x2="1712.5" y1="153.0234" y2="2157.9766"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1861.5" x2="1861.5" y1="153.0234" y2="2157.9766"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2003.5" x2="2003.5" y1="153.0234" y2="2157.9766"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2170" x2="2170" y1="153.0234" y2="2157.9766"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2344.5" x2="2344.5" y1="153.0234" y2="2157.9766"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2510.5" x2="2510.5" y1="153.0234" y2="2157.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="49" y="133.4248">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="53" y="149.7217">Payer</text><ellipse cx="75" cy="63.4297" fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M75,71.4297 L75,98.4297 M62,79.4297 L88,79.4297 M75,98.4297 L62,113.4297 M75,98.4297 L88,113.4297 " fill="none" filter="url(#f1pdzg8uomms1h)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="49" y="2169.9717">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="53" y="2186.2686">Payer</text><ellipse cx="75" cy="2199.5703" fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M75,2207.5703 L75,2234.5703 M62,2215.5703 L88,2215.5703 M75,2234.5703 L62,2249.5703 M75,2234.5703 L88,2249.5703 " fill="none" filter="url(#f1pdzg8uomms1h)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="111" y="133.4248">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="113" y="149.7217">Payee</text><ellipse cx="137" cy="63.4297" fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M137,71.4297 L137,98.4297 M124,79.4297 L150,79.4297 M137,98.4297 L124,113.4297 M137,98.4297 L150,113.4297 " fill="none" filter="url(#f1pdzg8uomms1h)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="111" y="2169.9717">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="113" y="2186.2686">Payee</text><ellipse cx="137" cy="2199.5703" fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M137,2207.5703 L137,2234.5703 M124,2215.5703 L150,2215.5703 M137,2234.5703 L124,2249.5703 M137,2234.5703 L150,2249.5703 " fill="none" filter="url(#f1pdzg8uomms1h)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="420" y="149.7217">ML API Adapter</text><path d="M453.5,108.7266 L453.5,132.7266 M453.5,120.7266 L470.5,120.7266 " fill="none" filter="url(#f1pdzg8uomms1h)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="482.5" cy="120.7266" fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="420" y="2169.9717">ML API Adapter</text><path d="M453.5,2177.2734 L453.5,2201.2734 M453.5,2189.2734 L470.5,2189.2734 " fill="none" filter="url(#f1pdzg8uomms1h)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="482.5" cy="2189.2734" fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="224" x="750" y="149.7217">ML API Notification Event Handler</text><ellipse cx="865" cy="120.7266" fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="861,108.7266,867,103.7266,865,108.7266,867,113.7266,861,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="224" x="750" y="2169.9717">ML API Notification Event Handler</text><ellipse cx="865" cy="2189.2734" fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="861,2177.2734,867,2172.2734,865,2177.2734,867,2182.2734,861,2177.2734" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="990" y="149.7217">Central Service API</text><path d="M1036.5,108.7266 L1036.5,132.7266 M1036.5,120.7266 L1053.5,120.7266 " fill="none" filter="url(#f1pdzg8uomms1h)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1065.5" cy="120.7266" fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="990" y="2169.9717">Central Service API</text><path d="M1036.5,2177.2734 L1036.5,2201.2734 M1036.5,2189.2734 L1053.5,2189.2734 " fill="none" filter="url(#f1pdzg8uomms1h)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1065.5" cy="2189.2734" fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="1138" y="113.7266"/><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="1134" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="1141" y="137.7217">Fulfil-Topic</text><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="1138" y="2156.9766"/><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="1134" y="2160.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="1141" y="2180.9717">Fulfil-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="130" x="1479.5" y="149.7217">Fulfil Event Handler</text><ellipse cx="1547.5" cy="120.7266" fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1543.5,108.7266,1549.5,103.7266,1547.5,108.7266,1549.5,113.7266,1543.5,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="130" x="1479.5" y="2169.9717">Fulfil Event Handler</text><ellipse cx="1547.5" cy="2189.2734" fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1543.5,2177.2734,1549.5,2172.2734,1547.5,2177.2734,1549.5,2182.2734,1543.5,2177.2734" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="1629.5" y="113.7266"/><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="1625.5" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1632.5" y="137.7217">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="1629.5" y="2156.9766"/><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="1625.5" y="2160.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1632.5" y="2180.9717">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1813.5" y="113.7266"/><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1809.5" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1816.5" y="137.7217">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1813.5" y="2156.9766"/><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1809.5" y="2160.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1816.5" y="2180.9717">Event-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="1923.5" y="149.7217">Position Event Handler</text><ellipse cx="2004" cy="120.7266" fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2000,108.7266,2006,103.7266,2004,108.7266,2006,113.7266,2000,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="1923.5" y="2169.9717">Position Event Handler</text><ellipse cx="2004" cy="2189.2734" fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2000,2177.2734,2006,2172.2734,2004,2177.2734,2006,2182.2734,2000,2177.2734" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="2113" y="113.7266"/><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="2109" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="2116" y="137.7217">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="2113" y="2156.9766"/><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="2109" y="2160.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="2116" y="2180.9717">Transfer-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2263.5" y="149.7217">Transfer Event Handler</text><ellipse cx="2345" cy="120.7266" fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2341,108.7266,2347,103.7266,2345,108.7266,2347,113.7266,2341,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2263.5" y="2169.9717">Transfer Event Handler</text><ellipse cx="2345" cy="2189.2734" fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2341,2177.2734,2347,2172.2734,2345,2177.2734,2347,2182.2734,2341,2177.2734" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="2444.5" y="113.7266"/><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="2440.5" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="2447.5" y="137.7217">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="2444.5" y="2156.9766"/><rect fill="#FEFECE" filter="url(#f1pdzg8uomms1h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="2440.5" y="2160.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="2447.5" y="2180.9717">Notification-Topic</text><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="589.1172" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="469" y="713.2734"/><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="1984.9531" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="860" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="86.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1176.5" y="1186.8594"/><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="1984.9531" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1542.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="1984.9531" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1999" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="1984.9531" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2340" y="163.0234"/><path d="M29,170.0234 L418,170.0234 L418,177.0234 L408,187.0234 L29,187.0234 L29,170.0234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1970.9531" style="stroke: #000000; stroke-width: 2.0;" width="2572.5" x="29" y="170.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="344" x="44" y="183.0903">DFSP2 sends a Fulfil Success Transfer request</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="137" x2="179" y1="238.5547" y2="238.5547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="179" x2="179" y1="238.5547" y2="251.5547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="138" x2="179" y1="251.5547" y2="251.5547"/><polygon fill="#A80036" points="148,247.5547,138,251.5547,148,255.5547,144,251.5547" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="144" y="218.356">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="157" y="203.2231">Retrieve fulfilment string generated during</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="157" y="218.356">the quoting process or regenerate it using</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="157" y="233.4888">Local secret</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="250" y="233.4888">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="278" y="233.4888">ILP Packet</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="360" y="233.4888">as inputs</text><path d="M142,264.5547 L142,682.5547 L479,682.5547 L479,274.5547 L469,264.5547 L142,264.5547 " fill="#FFFF00" filter="url(#f1pdzg8uomms1h)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M469,264.5547 L469,274.5547 L479,274.5547 L469,264.5547 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="148" y="281.6216">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="164" y="296.7544">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="164" y="311.8872">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="164" y="327.02">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="164" y="342.1528">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="164" y="357.2856">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="164" y="372.4185">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="164" y="387.5513">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="164" y="402.6841">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="164" y="417.8169">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="300" x="164" y="432.9497">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="148" y="448.0825">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="152" y="463.2153"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="148" y="478.3481">Payload - transferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="148" y="493.481">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="164" y="508.6138">"fulfilment": &lt;IlpFulfilment&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="164" y="523.7466">"completedTimestamp": &lt;DateTime&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="164" y="538.8794">"transferState": "COMMITTED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="164" y="554.0122">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="180" y="569.145">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="196" y="584.2778">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="212" y="599.4106">"key": &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="212" y="614.5435">"value": &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="196" y="629.6763">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="180" y="644.8091">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="164" y="659.9419">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="148" y="675.0747">}</text><polygon fill="#A80036" points="457,709.2734,467,713.2734,457,717.2734,461,713.2734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="137" x2="463" y1="713.2734" y2="713.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="144" y="708.2075">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="157" y="708.2075">PUT - /transfers/&lt;ID&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="479" x2="521" y1="757.5391" y2="757.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="521" x2="521" y1="757.5391" y2="770.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="480" x2="521" y1="770.5391" y2="770.5391"/><polygon fill="#A80036" points="490,766.5391,480,770.5391,490,774.5391,486,770.5391" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="486" y="744.9067">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="354" x="499" y="737.3403">Validate incoming token and originator matching Payee</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="499" y="752.4731">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="593" y="752.4731">3000-3002, 3100-3107</text><path d="M484,783.5391 L484,1141.5391 L799,1141.5391 L799,793.5391 L789,783.5391 L484,783.5391 " fill="#FFFF00" filter="url(#f1pdzg8uomms1h)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M789,783.5391 L789,793.5391 L799,793.5391 L789,783.5391 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="490" y="800.606">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="490" y="815.7388">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="506" y="830.8716">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="267" x="506" y="846.0044">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="506" y="861.1372">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="506" y="876.27">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="506" y="891.4028">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="522" y="906.5356">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="522" y="921.6685">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="506" y="936.8013">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="506" y="951.9341">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="522" y="967.0669">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="538" y="982.1997">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="538" y="997.3325">type: fulfil,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="538" y="1012.4653">action: commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="538" y="1027.5981">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="538" y="1042.731">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="554" y="1057.8638">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="554" y="1072.9966">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="538" y="1088.1294">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="522" y="1103.2622">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="506" y="1118.395">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="490" y="1133.5278">}</text><polygon fill="#A80036" points="1164.5,1182.8594,1174.5,1186.8594,1164.5,1190.8594,1168.5,1186.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="479" x2="1170.5" y1="1186.8594" y2="1186.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="486" y="1174.2271">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="499" y="1166.6606">Route &amp; Publish Fulfil event for Payee</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="499" y="1181.7935">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="585" y="1181.7935">2003</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1186.5" x2="1228.5" y1="1231.125" y2="1231.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1228.5" x2="1228.5" y1="1231.125" y2="1244.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1187.5" x2="1228.5" y1="1244.125" y2="1244.125"/><polygon fill="#A80036" points="1197.5,1240.125,1187.5,1244.125,1197.5,1248.125,1193.5,1244.125" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1193.5" y="1218.4927">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="329" x="1206.5" y="1210.9263">Ensure event is replicated as configured (ACKS=all)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="1206.5" y="1226.0591">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="1292.5" y="1226.0591">2003</text><polygon fill="#A80036" points="490,1269.2578,480,1273.2578,490,1277.2578,486,1273.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="484" x2="1180.5" y1="1273.2578" y2="1273.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="496" y="1268.1919">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="381" x="509" y="1268.1919">Respond replication acknowledgements have been received</text><polygon fill="#A80036" points="148,1298.3906,138,1302.3906,148,1306.3906,144,1302.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="142" x2="473" y1="1302.3906" y2="1302.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="154" y="1297.3247">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="167" y="1297.3247">Respond HTTP - 200 (OK)</text><polygon fill="#A80036" points="1192.5,1327.5234,1182.5,1331.5234,1192.5,1335.5234,1188.5,1331.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1186.5" x2="1541.5" y1="1331.5234" y2="1331.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1198.5" y="1326.4575">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="1211.5" y="1326.4575">Consume message</text><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="781.5" x="1131" y="1339.5234"/><polygon fill="#EEEEEE" points="1131,1339.5234,1197,1339.5234,1197,1346.5234,1187,1356.5234,1131,1356.5234,1131,1339.5234" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="1144" y="1353.5903">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1386.75" y="1372.5903">Fulfil Handler Consume (Success) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-fulfil-2.1.1.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-fulfil-2.1.1.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="36" x="1612.75" y="1372.5903">2.1.1.</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1612.75" x2="1648.75" y1="1374.5903" y2="1374.5903"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1648.75" y="1372.5903">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1390.75" y="1387.7231"/><polygon fill="#A80036" points="1700.5,1417.0547,1710.5,1421.0547,1700.5,1425.0547,1704.5,1421.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1552.5" x2="1706.5" y1="1421.0547" y2="1421.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1559.5" y="1415.9888">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="1572.5" y="1415.9888">Produce message</text><polygon fill="#A80036" points="1723.5,1471.1875,1713.5,1475.1875,1723.5,1479.1875,1719.5,1475.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1717.5" x2="1998" y1="1475.1875" y2="1475.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1729.5" y="1470.1216">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="1751.5" y="1470.1216">Consume message</text><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="607.5" x="1622.5" y="1483.1875"/><polygon fill="#EEEEEE" points="1622.5,1483.1875,1688.5,1483.1875,1688.5,1490.1875,1678.5,1500.1875,1622.5,1500.1875,1622.5,1483.1875" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="1635.5" y="1497.2544">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="1725.75" y="1516.2544">Position Handler Consume (Success) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-position-1.3.2-fulfil.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-position-1.3.2-fulfil.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="145" x="1973.75" y="1516.2544">seq-position-1.3.2-fulfil</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1973.75" x2="2118.75" y1="1518.2544" y2="1518.2544"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="2118.75" y="1516.2544">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1729.75" y="1531.3872"/><polygon fill="#A80036" points="2158,1560.7188,2168,1564.7188,2158,1568.7188,2162,1564.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2009" x2="2164" y1="1564.7188" y2="1564.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2016" y="1559.6528">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="2038" y="1559.6528">Produce message</text><polygon fill="#A80036" points="2181,1614.8516,2171,1618.8516,2181,1622.8516,2177,1618.8516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2175" x2="2339" y1="1618.8516" y2="1618.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2187" y="1613.7856">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="2209" y="1613.7856">Consume message</text><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="774" x="1806.5" y="1626.8516"/><polygon fill="#EEEEEE" points="1806.5,1626.8516,1872.5,1626.8516,1872.5,1633.8516,1862.5,1643.8516,1806.5,1643.8516,1806.5,1626.8516" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="1819.5" y="1640.9185">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="2046.5" y="1659.9185">Transfer Handler Consume (Success) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-fulfil-2.1.3.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-fulfil-2.1.3.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="36" x="2296.5" y="1659.9185">2.1.3.</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2296.5" x2="2332.5" y1="1661.9185" y2="1661.9185"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="2332.5" y="1659.9185">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="2050.5" y="1675.0513"/><polygon fill="#A80036" points="2499,1704.3828,2509,1708.3828,2499,1712.3828,2503,1708.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2350" x2="2505" y1="1708.3828" y2="1708.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2357" y="1703.3169">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="2379" y="1703.3169">Produce message</text><polygon fill="#A80036" points="2499,1758.5156,2509,1762.5156,2499,1766.5156,2503,1762.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="870" x2="2505" y1="1762.5156" y2="1762.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="877" y="1757.4497">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="899" y="1757.4497">Consume message</text><path d="M39,1777.5156 L109,1777.5156 L109,1784.5156 L99,1794.5156 L39,1794.5156 L39,1777.5156 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="131.6641" style="stroke: #000000; stroke-width: 2.0;" width="2552.5" x="39" y="1777.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="54" y="1790.5825">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="124" y="1789.7261">[action == 'commit']</text><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="2534.5" x="46" y="1819.6484"/><polygon fill="#EEEEEE" points="46,1819.6484,112,1819.6484,112,1826.6484,102,1836.6484,46,1836.6484,46,1819.6484" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="59" y="1833.7153">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="1156.25" y="1852.7153">Send notification to Participant (Payer) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="48" x="1414.25" y="1852.7153">1.1.4.a.</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1414.25" x2="1462.25" y1="1854.7153" y2="1854.7153"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1462.25" y="1852.7153">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1160.25" y="1867.8481"/><polygon fill="#A80036" points="86,1897.1797,76,1901.1797,86,1905.1797,82,1901.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="80" x2="859" y1="1901.1797" y2="1901.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="92" y="1896.1138">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="114" y="1896.1138">Send callback notification</text><polygon fill="#A80036" points="2499,1958.3125,2509,1962.3125,2499,1966.3125,2503,1962.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="870" x2="2505" y1="1962.3125" y2="1962.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="877" y="1957.2466">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="899" y="1957.2466">Consume message</text><path d="M101,1977.3125 L171,1977.3125 L171,1984.3125 L161,1994.3125 L101,1994.3125 L101,1977.3125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="131.6641" style="stroke: #000000; stroke-width: 2.0;" width="2490.5" x="101" y="1977.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="116" y="1990.3794">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="186" y="1989.5229">[action == 'commit']</text><rect fill="#FFFFFF" filter="url(#f1pdzg8uomms1h)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="2472.5" x="108" y="2019.4453"/><polygon fill="#EEEEEE" points="108,2019.4453,174,2019.4453,174,2026.4453,164,2036.4453,108,2036.4453,108,2019.4453" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="121" y="2033.5122">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="1185.75" y="2052.5122">Send notification to Participant (Payee) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="48" x="1446.75" y="2052.5122">1.1.4.a.</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1446.75" x2="1494.75" y1="2054.5122" y2="2054.5122"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1494.75" y="2052.5122">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1189.75" y="2067.645"/><polygon fill="#A80036" points="148,2096.9766,138,2100.9766,148,2104.9766,144,2100.9766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="142" x2="859" y1="2100.9766" y2="2100.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="154" y="2095.9106">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="176" y="2095.9106">Send callback notification</text><!--
@startuml
title 2.1.0. DFSP2 sends a Fulfil Success Transfer request

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Fulfil-Topic" as TOPIC_FULFIL
control "Fulfil Event Handler" as FULF_HANDLER
collections "topic-transfer-position" as TOPIC_TRANSFER_POSITION
control "Position Event Handler" as POS_HANDLER
collections "Transfer-Topic" as TOPIC_TRANSFERS
collections "Event-Topic" as TOPIC_EVENTS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_FULFIL
    participant FULF_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant TOPIC_EVENTS
    participant POS_HANDLER
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate FULF_HANDLER
activate POS_HANDLER
activate TRANS_HANDLER
group DFSP2 sends a Fulfil Success Transfer request
    DFSP2 <-> DFSP2: Retrieve fulfilment string generated during\nthe quoting process or regenerate it using\n**Local secret** and **ILP Packet** as inputs
    note right of DFSP2 #yellow
        Headers - transferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - transferMessage:
        {
            "fulfilment": <IlpFulfilment>,
            "completedTimestamp": <DateTime>,
            "transferState": "COMMITTED",
            "extensionList": {
                "extension": [
                    {
                        "key": <string>,
                        "value": <string>
                    }
                ]
            }
        }
    end note
    DFSP2 -> MLAPI: PUT - /transfers/<ID>
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming token and originator matching Payee\n<color #FF0000><b>Error codes:</b> 3000-3002, 3100-3107</color>
    note right of MLAPI #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: fulfil,
                    action: commit,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_FULFIL: Route & Publish Fulfil event for Payee\n<color #FF0000><b>Error code:</b> 2003</color>
    activate TOPIC_FULFIL
    TOPIC_FULFIL <-> TOPIC_FULFIL: Ensure event is replicated as configured (ACKS=all)\n<color #FF0000><b>Error code:</b> 2003</color>
    TOPIC_FULFIL - -> MLAPI: Respond replication acknowledgements have been received
    deactivate TOPIC_FULFIL
    MLAPI - -> DFSP2: Respond HTTP - 200 (OK)
    deactivate MLAPI
    TOPIC_FULFIL <- FULF_HANDLER: Consume message
    ref over TOPIC_FULFIL, TOPIC_EVENTS: Fulfil Handler Consume (Success) {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-fulfil-2.1.1.svg 2.1.1.]]} \n
    FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Produce message
    |||
    TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume message
    ref over TOPIC_TRANSFER_POSITION, TOPIC_TRANSFERS:  Position Handler Consume (Success) {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-position-1.3.2-fulfil.svg seq-position-1.3.2-fulfil]]} \n
    POS_HANDLER -> TOPIC_TRANSFERS: Produce message
    |||
    TOPIC_TRANSFERS <- TRANS_HANDLER: Consume message
    ref over TOPIC_EVENTS, TOPIC_NOTIFICATIONS: Transfer Handler Consume (Success) {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-fulfil-2.1.3.svg 2.1.3.]]} \n
    TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    opt action == 'commit'
        |||
        ref over DFSP1, TOPIC_NOTIFICATIONS: Send notification to Participant (Payer) {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg 1.1.4.a.]]} \n
        NOTIFY_HANDLER -> DFSP1: Send callback notification
    end
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    opt action == 'commit'
        |||
        ref over DFSP2, TOPIC_NOTIFICATIONS: Send notification to Participant (Payee) {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg 1.1.4.a.]]} \n
        NOTIFY_HANDLER -> DFSP2: Send callback notification
    end
    |||
end
deactivate TRANS_HANDLER
deactivate POS_HANDLER
deactivate FULF_HANDLER
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2018.12(Sun Oct 21 05:15:15 CDT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_191-8u191-b12-0ubuntu0.16.04.1-b12
Operating System: Linux
OS Version: 4.4.0-31-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>