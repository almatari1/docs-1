<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2074px" preserveAspectRatio="none" style="width:2418px;height:2074px;" version="1.1" viewBox="0 0 2418 2074" width="2418px" zoomAndPan="magnify"><defs><filter height="300%" id="fo6ykjprpspj8" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="451" x="984.5" y="22.9951">1.1.0. DFSP1 sends a Prepare Transfer request to DFSP2</text><rect fill="#D3D3D3" height="2028.875" style="stroke: #A80036; stroke-width: 1.0;" width="204" x="4" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="198" x="7" y="46.3638">Financial Service Providers</text><rect fill="#ADD8E6" height="2028.875" style="stroke: #A80036; stroke-width: 1.0;" width="565" x="302" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173" x="498" y="46.3638">ML API Adapter Service</text><rect fill="#FFFFE0" height="2028.875" style="stroke: #A80036; stroke-width: 1.0;" width="1532" x="869" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="1579.5" y="46.3638">Central Service</text><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="589.1172" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="355" y="746.8047"/><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="1787.5547" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="743" y="163.0234"/><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="86.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1094" y="1220.3906"/><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="1787.5547" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1460" y="163.0234"/><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="1787.5547" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1814.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="1787.5547" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2155.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="1773.5547" style="stroke: #000000; stroke-width: 2.0;" width="2368" x="39" y="170.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="75" x2="75" y1="153.0234" y2="1960.5781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="137" x2="137" y1="153.0234" y2="1960.5781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="360" x2="360" y1="153.0234" y2="1960.5781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="748" x2="748" y1="153.0234" y2="1960.5781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="940" x2="940" y1="153.0234" y2="1960.5781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1099" x2="1099" y1="153.0234" y2="1960.5781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1465" x2="1465" y1="153.0234" y2="1960.5781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1642" x2="1642" y1="153.0234" y2="1960.5781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1819" x2="1819" y1="153.0234" y2="1960.5781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1985.5" x2="1985.5" y1="153.0234" y2="1960.5781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2160" x2="2160" y1="153.0234" y2="1960.5781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2326" x2="2326" y1="153.0234" y2="1960.5781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="49" y="133.4248">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="53" y="149.7217">Payer</text><ellipse cx="75" cy="63.4297" fill="#FEFECE" filter="url(#fo6ykjprpspj8)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M75,71.4297 L75,98.4297 M62,79.4297 L88,79.4297 M75,98.4297 L62,113.4297 M75,98.4297 L88,113.4297 " fill="none" filter="url(#fo6ykjprpspj8)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="49" y="1972.5732">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="53" y="1988.8701">Payer</text><ellipse cx="75" cy="2002.1719" fill="#FEFECE" filter="url(#fo6ykjprpspj8)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M75,2010.1719 L75,2037.1719 M62,2018.1719 L88,2018.1719 M75,2037.1719 L62,2052.1719 M75,2037.1719 L88,2052.1719 " fill="none" filter="url(#fo6ykjprpspj8)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="111" y="133.4248">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="113" y="149.7217">Payee</text><ellipse cx="137" cy="63.4297" fill="#FEFECE" filter="url(#fo6ykjprpspj8)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M137,71.4297 L137,98.4297 M124,79.4297 L150,79.4297 M137,98.4297 L124,113.4297 M137,98.4297 L150,113.4297 " fill="none" filter="url(#fo6ykjprpspj8)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="111" y="1972.5732">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="113" y="1988.8701">Payee</text><ellipse cx="137" cy="2002.1719" fill="#FEFECE" filter="url(#fo6ykjprpspj8)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M137,2010.1719 L137,2037.1719 M124,2018.1719 L150,2018.1719 M137,2037.1719 L124,2052.1719 M137,2037.1719 L150,2052.1719 " fill="none" filter="url(#fo6ykjprpspj8)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="306" y="149.7217">ML API Adapter</text><path d="M339.5,108.7266 L339.5,132.7266 M339.5,120.7266 L356.5,120.7266 " fill="none" filter="url(#fo6ykjprpspj8)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="368.5" cy="120.7266" fill="#FEFECE" filter="url(#fo6ykjprpspj8)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="306" y="1972.5732">ML API Adapter</text><path d="M339.5,1979.875 L339.5,2003.875 M339.5,1991.875 L356.5,1991.875 " fill="none" filter="url(#fo6ykjprpspj8)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="368.5" cy="1991.875" fill="#FEFECE" filter="url(#fo6ykjprpspj8)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="224" x="633" y="149.7217">ML API Notification Event Handler</text><ellipse cx="748" cy="120.7266" fill="#FEFECE" filter="url(#fo6ykjprpspj8)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="744,108.7266,750,103.7266,748,108.7266,750,113.7266,744,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="224" x="633" y="1972.5732">ML API Notification Event Handler</text><ellipse cx="748" cy="1991.875" fill="#FEFECE" filter="url(#fo6ykjprpspj8)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="744,1979.875,750,1974.875,748,1979.875,750,1984.875,744,1979.875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="873" y="149.7217">Central Service API</text><path d="M919.5,108.7266 L919.5,132.7266 M919.5,120.7266 L936.5,120.7266 " fill="none" filter="url(#fo6ykjprpspj8)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="948.5" cy="120.7266" fill="#FEFECE" filter="url(#fo6ykjprpspj8)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="873" y="1972.5732">Central Service API</text><path d="M919.5,1979.875 L919.5,2003.875 M919.5,1991.875 L936.5,1991.875 " fill="none" filter="url(#fo6ykjprpspj8)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="948.5" cy="1991.875" fill="#FEFECE" filter="url(#fo6ykjprpspj8)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fo6ykjprpspj8)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="1021" y="113.7266"/><rect fill="#FEFECE" filter="url(#fo6ykjprpspj8)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="1017" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="1024" y="137.7217">topic-trasfer-prepare</text><rect fill="#FEFECE" filter="url(#fo6ykjprpspj8)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="1021" y="1959.5781"/><rect fill="#FEFECE" filter="url(#fo6ykjprpspj8)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="1017" y="1963.5781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="1024" y="1983.5732">topic-trasfer-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1385" y="149.7217">Prepare Event Handler</text><ellipse cx="1465" cy="120.7266" fill="#FEFECE" filter="url(#fo6ykjprpspj8)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1461,108.7266,1467,103.7266,1465,108.7266,1467,113.7266,1461,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1385" y="1972.5732">Prepare Event Handler</text><ellipse cx="1465" cy="1991.875" fill="#FEFECE" filter="url(#fo6ykjprpspj8)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1461,1979.875,1467,1974.875,1465,1979.875,1467,1984.875,1461,1979.875" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fo6ykjprpspj8)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="1559" y="113.7266"/><rect fill="#FEFECE" filter="url(#fo6ykjprpspj8)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="1555" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1562" y="137.7217">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#fo6ykjprpspj8)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="1559" y="1959.5781"/><rect fill="#FEFECE" filter="url(#fo6ykjprpspj8)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="1555" y="1963.5781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1562" y="1983.5732">topic-transfer-position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="1739" y="149.7217">Position Event Handler</text><ellipse cx="1819.5" cy="120.7266" fill="#FEFECE" filter="url(#fo6ykjprpspj8)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1815.5,108.7266,1821.5,103.7266,1819.5,108.7266,1821.5,113.7266,1815.5,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="1739" y="1972.5732">Position Event Handler</text><ellipse cx="1819.5" cy="1991.875" fill="#FEFECE" filter="url(#fo6ykjprpspj8)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1815.5,1979.875,1821.5,1974.875,1819.5,1979.875,1821.5,1984.875,1815.5,1979.875" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fo6ykjprpspj8)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="1928.5" y="113.7266"/><rect fill="#FEFECE" filter="url(#fo6ykjprpspj8)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="1924.5" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="1931.5" y="137.7217">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#fo6ykjprpspj8)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="1928.5" y="1959.5781"/><rect fill="#FEFECE" filter="url(#fo6ykjprpspj8)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="1924.5" y="1963.5781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="1931.5" y="1983.5732">Transfer-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2079" y="149.7217">Transfer Event Handler</text><ellipse cx="2160.5" cy="120.7266" fill="#FEFECE" filter="url(#fo6ykjprpspj8)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2156.5,108.7266,2162.5,103.7266,2160.5,108.7266,2162.5,113.7266,2156.5,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="2079" y="1972.5732">Transfer Event Handler</text><ellipse cx="2160.5" cy="1991.875" fill="#FEFECE" filter="url(#fo6ykjprpspj8)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2156.5,1979.875,2162.5,1974.875,2160.5,1979.875,2162.5,1984.875,2156.5,1979.875" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fo6ykjprpspj8)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="2260" y="113.7266"/><rect fill="#FEFECE" filter="url(#fo6ykjprpspj8)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="2256" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="2263" y="137.7217">Notification-Topic</text><rect fill="#FEFECE" filter="url(#fo6ykjprpspj8)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="2260" y="1959.5781"/><rect fill="#FEFECE" filter="url(#fo6ykjprpspj8)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="2256" y="1963.5781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="2263" y="1983.5732">Notification-Topic</text><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="589.1172" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="355" y="746.8047"/><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="1787.5547" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="743" y="163.0234"/><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="86.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1094" y="1220.3906"/><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="1787.5547" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1460" y="163.0234"/><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="1787.5547" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1814.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="1787.5547" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2155.5" y="163.0234"/><path d="M39,170.0234 L460,170.0234 L460,177.0234 L450,187.0234 L39,187.0234 L39,170.0234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1773.5547" style="stroke: #000000; stroke-width: 2.0;" width="2368" x="39" y="170.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="376" x="54" y="183.0903">DFSP1 sends a Prepare Transfer request to DFSP2</text><path d="M80,192.1563 L80,716.1563 L417,716.1563 L417,202.1563 L407,192.1563 L80,192.1563 " fill="#FFFF00" filter="url(#fo6ykjprpspj8)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M407,192.1563 L407,202.1563 L417,202.1563 L407,192.1563 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="86" y="209.2231">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="102" y="224.356">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="102" y="239.4888">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="102" y="254.6216">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="102" y="269.7544">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="102" y="284.8872">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="102" y="300.02">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="102" y="315.1528">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="102" y="330.2856">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="102" y="345.4185">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="300" x="102" y="360.5513">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="86" y="375.6841">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="90" y="390.8169"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="86" y="405.9497">Payload - transferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="86" y="421.0825">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="102" y="436.2153">"transferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="102" y="451.3481">"payeeFsp": dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="102" y="466.481">"payerFsp": dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="102" y="481.6138">"amount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="118" y="496.7466">"currency": "AED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="118" y="511.8794">"amount": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="102" y="527.0122">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="102" y="542.145">"ilpPacket": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="102" y="557.2778">"condition": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="102" y="572.4106">"expiration": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="102" y="587.5435">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="118" y="602.6763">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="134" y="617.8091">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="150" y="632.9419">"key": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="150" y="648.0747">"value": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="134" y="663.2075">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="118" y="678.3403">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="102" y="693.4731">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="86" y="708.606">}</text><polygon fill="#A80036" points="343,742.8047,353,746.8047,343,750.8047,347,746.8047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="75" x2="349" y1="746.8047" y2="746.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="82" y="741.7388">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="95" y="741.7388">POST - /transfers</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="365" x2="407" y1="791.0703" y2="791.0703"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="407" x2="407" y1="791.0703" y2="804.0703"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="366" x2="407" y1="804.0703" y2="804.0703"/><polygon fill="#A80036" points="376,800.0703,366,804.0703,376,808.0703,372,804.0703" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="372" y="778.438">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="351" x="385" y="770.8716">Validate incoming token and originator matching Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="385" y="786.0044">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="479" y="786.0044">3000-3002, 3100-3107</text><path d="M370,817.0703 L370,1175.0703 L640,1175.0703 L640,827.0703 L630,817.0703 L370,817.0703 " fill="#FFFF00" filter="url(#fo6ykjprpspj8)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M630,817.0703 L630,827.0703 L640,827.0703 L630,817.0703 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="376" y="834.1372">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="376" y="849.27">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="392" y="864.4028">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="392" y="879.5356">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="392" y="894.6685">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="392" y="909.8013">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="392" y="924.9341">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="408" y="940.0669">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="408" y="955.1997">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="392" y="970.3325">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="392" y="985.4653">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="408" y="1000.5981">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="424" y="1015.731">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="424" y="1030.8638">type: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="424" y="1045.9966">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="424" y="1061.1294">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="424" y="1076.2622">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="440" y="1091.395">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="440" y="1106.5278">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="424" y="1121.6606">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="408" y="1136.7935">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="392" y="1151.9263">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="376" y="1167.0591">}</text><polygon fill="#A80036" points="1082,1216.3906,1092,1220.3906,1082,1224.3906,1086,1220.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="365" x2="1088" y1="1220.3906" y2="1220.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="372" y="1207.7583">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="385" y="1200.1919">Route &amp; Publish Prepare event for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="385" y="1215.3247">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="471" y="1215.3247">2003</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1104" x2="1146" y1="1264.6563" y2="1264.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1146" x2="1146" y1="1264.6563" y2="1277.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1105" x2="1146" y1="1277.6563" y2="1277.6563"/><polygon fill="#A80036" points="1115,1273.6563,1105,1277.6563,1115,1281.6563,1111,1277.6563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1111" y="1252.0239">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="329" x="1124" y="1244.4575">Ensure event is replicated as configured (ACKS=all)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="1124" y="1259.5903">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="1210" y="1259.5903">2003</text><polygon fill="#A80036" points="376,1302.7891,366,1306.7891,376,1310.7891,372,1306.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="370" x2="1098" y1="1306.7891" y2="1306.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="382" y="1301.7231">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="381" x="395" y="1301.7231">Respond replication acknowledgements have been received</text><polygon fill="#A80036" points="86,1331.9219,76,1335.9219,86,1339.9219,82,1335.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="80" x2="359" y1="1335.9219" y2="1335.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="92" y="1330.856">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="105" y="1330.856">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1110,1386.0547,1100,1390.0547,1110,1394.0547,1106,1390.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1104" x2="1459" y1="1390.0547" y2="1390.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1116" y="1384.9888">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="1129" y="1384.9888">Consume message</text><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="714" x="1014" y="1398.0547"/><polygon fill="#EEEEEE" points="1014,1398.0547,1080,1398.0547,1080,1405.0547,1070,1415.0547,1014,1415.0547,1014,1398.0547" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="1027" y="1412.1216">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="1228.5" y="1431.1216">Prepare Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.1.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.1.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="44" x="1409.5" y="1431.1216">1.1.1.a</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1409.5" x2="1453.5" y1="1433.1216" y2="1433.1216"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1453.5" y="1431.1216">,</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.1.b.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.1.b.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="44" x="1461.5" y="1431.1216">1.1.1.b</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1461.5" x2="1505.5" y1="1433.1216" y2="1433.1216"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1505.5" y="1431.1216">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1232.5" y="1446.2544"/><polygon fill="#A80036" points="1630,1475.5859,1640,1479.5859,1630,1483.5859,1634,1479.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1470" x2="1636" y1="1479.5859" y2="1479.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1477" y="1474.52">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="1490" y="1474.52">Produce message</text><polygon fill="#A80036" points="1653,1529.7188,1643,1533.7188,1653,1537.7188,1649,1533.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1647" x2="1813.5" y1="1533.7188" y2="1533.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1659" y="1528.6528">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="1672" y="1528.6528">Consume message</text><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="493.5" x="1552" y="1541.7188"/><polygon fill="#EEEEEE" points="1552,1541.7188,1618,1541.7188,1618,1548.7188,1608,1558.7188,1552,1558.7188,1552,1541.7188" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="1565" y="1555.7856">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="1656.25" y="1574.7856">Position Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.2.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.2.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="44" x="1837.25" y="1574.7856">1.1.2.a</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1837.25" x2="1881.25" y1="1576.7856" y2="1576.7856"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1881.25" y="1574.7856">,</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.2.b.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.2.b.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="44" x="1889.25" y="1574.7856">1.1.2.b</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1889.25" x2="1933.25" y1="1576.7856" y2="1576.7856"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1933.25" y="1574.7856">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1660.25" y="1589.9185"/><polygon fill="#A80036" points="1973.5,1619.25,1983.5,1623.25,1973.5,1627.25,1977.5,1623.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1824.5" x2="1979.5" y1="1623.25" y2="1623.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1831.5" y="1618.1841">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="1853.5" y="1618.1841">Produce message</text><polygon fill="#A80036" points="1996.5,1673.3828,1986.5,1677.3828,1996.5,1681.3828,1992.5,1677.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1990.5" x2="2154.5" y1="1677.3828" y2="1677.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2002.5" y="1672.3169">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="2024.5" y="1672.3169">Consume message</text><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="474.5" x="1921.5" y="1685.3828"/><polygon fill="#EEEEEE" points="1921.5,1685.3828,1987.5,1685.3828,1987.5,1692.3828,1977.5,1702.3828,1921.5,1702.3828,1921.5,1685.3828" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="1934.5" y="1699.4497">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="2015.25" y="1718.4497">Transfer Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.3.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.3.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="44" x="2198.25" y="1718.4497">1.1.3.a</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2198.25" x2="2242.25" y1="1720.4497" y2="1720.4497"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="2242.25" y="1718.4497">,</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.3.b.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.3.b.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="44" x="2250.25" y="1718.4497">1.2.3.b</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="2250.25" x2="2294.25" y1="1720.4497" y2="1720.4497"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="2294.25" y="1718.4497">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="2019.25" y="1733.5825"/><polygon fill="#A80036" points="2314.5,1762.9141,2324.5,1766.9141,2314.5,1770.9141,2318.5,1766.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2165.5" x2="2320.5" y1="1766.9141" y2="1766.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2172.5" y="1761.8481">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="2194.5" y="1761.8481">Produce message</text><polygon fill="#A80036" points="2314.5,1817.0469,2324.5,1821.0469,2314.5,1825.0469,2318.5,1821.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="753" x2="2320.5" y1="1821.0469" y2="1821.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="760" y="1815.981">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="782" y="1815.981">Consume message</text><rect fill="#FFFFFF" filter="url(#fo6ykjprpspj8)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="2288" x="108" y="1829.0469"/><polygon fill="#EEEEEE" points="108,1829.0469,174,1829.0469,174,1836.0469,164,1846.0469,108,1846.0469,108,1829.0469" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="121" y="1843.1138">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="1069.5" y="1862.1138">Send notification to Participant (Payee) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="44" x="1330.5" y="1862.1138">1.1.4.a</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1330.5" x2="1374.5" y1="1864.1138" y2="1864.1138"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1374.5" y="1862.1138">,</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.b.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.b.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="44" x="1382.5" y="1862.1138">1.1.4.b</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1382.5" x2="1426.5" y1="1864.1138" y2="1864.1138"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1426.5" y="1862.1138">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1073.5" y="1877.2466"/><polygon fill="#A80036" points="148,1906.5781,138,1910.5781,148,1914.5781,144,1910.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="142" x2="742" y1="1910.5781" y2="1910.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="154" y="1905.5122">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="176" y="1905.5122">Send callback notification</text><!--
@startuml
title 1.1.0. DFSP1 sends a Prepare Transfer request to DFSP2

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "topic-trasfer-prepare" as TOPIC_TRANSFER_PREPARE
control "Prepare Event Handler" as PREP_HANDLER
collections "topic-transfer-position" as TOPIC_TRANSFER_POSITION
control "Position Event Handler" as POS_HANDLER
collections "Transfer-Topic" as TOPIC_TRANSFERS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_TRANSFER_PREPARE
    participant PREP_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant POS_HANDLER
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate PREP_HANDLER
activate POS_HANDLER
activate TRANS_HANDLER
group DFSP1 sends a Prepare Transfer request to DFSP2
    note right of DFSP1 #yellow
        Headers - transferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - transferMessage:
        {
            "transferId": <uuid>,
            "payeeFsp": dfsp2,
            "payerFsp": dfsp1,
            "amount": {
                "currency": "AED",
                "amount": "string"
            },
            "ilpPacket": "string",
            "condition": "string",
            "expiration": "string",
            "extensionList": {
                "extension": [
                    {
                        "key": "string",
                        "value": "string"
                    }
                ]
            }
        }
    end note
    DFSP1 -> MLAPI: POST - /transfers
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming token and originator matching Payer\n<color #FF0000><b>Error codes:</b> 3000-3002, 3100-3107</color>
    note right of MLAPI #yellow
        Message:
        {
            id: <transferMessage.transferId>
            from: <transferMessage.payerFsp>,
            to: <transferMessage.payeeFsp>,
            type: application/json
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: prepare,
                    action: prepare,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_TRANSFER_PREPARE: Route & Publish Prepare event for Payer\n<color #FF0000><b>Error code:</b> 2003</color>
    activate TOPIC_TRANSFER_PREPARE
    TOPIC_TRANSFER_PREPARE <-> TOPIC_TRANSFER_PREPARE: Ensure event is replicated as configured (ACKS=all)\n<color #FF0000><b>Error code:</b> 2003</color>
    TOPIC_TRANSFER_PREPARE - -> MLAPI: Respond replication acknowledgements have been received
    deactivate TOPIC_TRANSFER_PREPARE
    MLAPI - - -> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI
    |||
    TOPIC_TRANSFER_PREPARE <- PREP_HANDLER: Consume message
    ref over TOPIC_TRANSFER_PREPARE, PREP_HANDLER, TOPIC_TRANSFER_POSITION :  Prepare Handler Consume {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.1.a.svg 1.1.1.a]], [[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.1.b.svg 1.1.1.b]]} \n
    PREP_HANDLER -> TOPIC_TRANSFER_POSITION: Produce message
    |||
    TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume message
    ref over TOPIC_TRANSFER_POSITION, POS_HANDLER, TOPIC_TRANSFERS : Position Handler Consume {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.2.a.svg 1.1.2.a]], [[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.2.b.svg 1.1.2.b]]} \n
    POS_HANDLER -> TOPIC_TRANSFERS: Produce message
    |||
    TOPIC_TRANSFERS <- TRANS_HANDLER: Consume message
    ref over TOPIC_TRANSFERS, TRANS_HANDLER, TOPIC_NOTIFICATIONS : Transfer Handler Consume {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.3.a.svg 1.1.3.a]], [[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.3.b.svg 1.2.3.b]]} \n
    TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    ref over DFSP2, TOPIC_NOTIFICATIONS : Send notification to Participant (Payee) {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.a.svg 1.1.4.a]], [[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-prepare-1.1.4.b.svg 1.1.4.b]]} \n
    NOTIFY_HANDLER -> DFSP2: Send callback notification
    |||
end
deactivate TRANS_HANDLER
deactivate POS_HANDLER
deactivate PREP_HANDLER
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2018.12(Sun Oct 21 05:15:15 CDT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_191-8u191-b12-0ubuntu0.16.04.1-b12
Operating System: Linux
OS Version: 4.4.0-31-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>